<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us class=is-clipped><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=https://zmsy.co/><title>zmsy | Building Dynamic Dungeons using Unity Tilemaps</title><meta name=og:title content="Building Dynamic Dungeons using Unity Tilemaps"><meta name=description content="Generating a dungeon layout is both an art and a science. There's a lot of confusingly different approaches, and here's how I tackled the problem."><meta name=og:description content="Generating a dungeon layout is both an art and a science. There's a lot of confusingly different approaches, and here's how I tackled the problem."><meta name=theme-color content="#3a89c9"><link rel=preload href=https://zmsy.co/fonts/patua-one/patua-one-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://zmsy.co/fonts/work-sans/work-sans-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><style>@font-face{font-family:patua one;font-weight:400;font-display:block;src:url(/fonts/patua-one/patua-one-latin-400-normal.woff2)format("woff2"),url(/fonts/patua-one/patua-one-latin-400-normal.woff)format("woff")}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-400-normal.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-ext-400-normal.woff2)format("woff2");unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:work sans;font-style:italic;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-400-italic.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:italic;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-ext-400-italic.woff2)format("woff2");unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:700;src:url(/fonts/work-sans/work-sans-latin-700-normal.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:700;src:url(/fonts/work-sans/work-sans-latin-ext-700-normal.woff2)format("woff2");unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:icomoon;src:url(/fonts/icomoon/icomoon.eot);src:url(/fonts/icomoon/icomoon.eot)format("embedded-opentype"),url(/fonts/icomoon/icomoon.ttf)format("truetype"),url(/fonts/icomoon/icomoon.woff)format("woff"),url(/fonts/icomoon/icomoon.svg)format("svg");font-weight:400;font-style:normal;font-display:block}[class^=icon-],[class*=" icon-"]{font-family:icomoon!important;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-heart:before{content:"\f004"}.icon-star:before{content:"\f005"}.icon-check:before{content:"\f00c"}.icon-close:before{content:"\f00d"}.icon-remove:before{content:"\f00d"}.icon-times:before{content:"\f00d"}.icon-external-link:before{content:"\f08e"}.icon-cut:before{content:"\f0c4"}.icon-scissors:before{content:"\f0c4"}.icon-copy:before{content:"\f0c5"}.icon-files-o:before{content:"\f0c5"}.icon-caret-down:before{content:"\f0d7"}.icon-caret-up:before{content:"\f0d8"}.icon-caret-left:before{content:"\f0d9"}.icon-caret-right:before{content:"\f0da"}.icon-cloud-download:before{content:"\f0ed"}.icon-chevron-circle-up:before{content:"\f139"}.icon-chevron-circle-down:before{content:"\f13a"}.icon-sliders:before{content:"\f1de"}.icon-spotify:before{content:"\e900"}.icon-envelope:before{content:"\e901"}.icon-github:before{content:"\e902"}.icon-twitter:before{content:"\e903"}.icon-linkedin-square:before{content:"\e904"}.icon-paw:before{content:"\e905"}</style><link rel=stylesheet href=https://zmsy.co/css/main.ca70caa65f268b30665dcdb7a078938a9f4fa830bf71751ef2ce4dd2b8fd4048.css integrity="sha256-ynDKpl8mizBmXc23oHiTip9PqDC/cXUe8s5N0rj9QEg="><link rel=icon type=image/png href=https://zmsy.co/media/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://zmsy.co/media/favicon-16x16.png sizes=16x16><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/zmsy.co\/"},"name":"Building Dynamic Dungeons using Unity Tilemaps","headline":"Building Dynamic Dungeons using Unity Tilemaps","description":"Generating a dungeon layout is both an art and a science. There\u0027s a lot of confusingly different approaches, and here\u0027s how I tackled the problem.","inLanguage":"en-US","author":"Zach Morrissey","creator":"Zach Morrissey","publisher":"Zach Morrissey","copyrightHolder":"Zach Morrissey","copyrightYear":"2022","datePublished":"2018-01-31","dateModified":"2022-10-22T19:04:11Z","url":"https:\/\/zmsy.co\/blog\/building-dynamic-dungeons-using-unity-tilemaps\/","keywords":["Blog"]}</script></head><body><div id=nav-modal></div><div class="columns is-centered" id=navbar-columns><div class="column is-10 is-12-touch" id=navbar-column><nav class=navbar role=navigation id=top><div class=navbar-brand><a class=navbar-item href=https://zmsy.co/><figure class="color-responsive-svg logo-img"><!doctype html><svg width="100%" height="100%" viewBox="0 0 209 209" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5"><circle cx="170.833" cy="33.333" r="33.333" style="fill:#9665c7"/><circle cx="127.778" cy="175" r="33.333" style="fill:#3a89c9"/><circle cx="37.5" cy="175" r="33.333" style="fill:#d85d44"/><circle cx="80.556" cy="33.333" r="33.333" style="fill:#fbd136"/><path d="M37.5 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M127.778 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M170.833 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M80.556 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/></svg></figure></a><a class=navbar-item href=https://zmsy.co/><div class=is-3 id=logo-text>zmsy.co</div></a><span class=navbar-burger id=navbar-toggle><span></span>
<span></span>
<span></span></span></div><div class=navbar-menu><div class=navbar-end><a class="navbar-item is-hidden-mobile" href=https://www.linkedin.com/in/zmsy><span class=icon-linkedin-square title="View my LinkedIn profile."></span></a>
<a class="navbar-item is-hidden-mobile" href=https://github.com/zmsy><span class=icon-github title="Check out my Github."></span></a>
<a class="navbar-item is-hidden-mobile" href=https://twitter.com/_zmsy><span class=icon-twitter title="Check out my sparsely used Twitter account."></span></a>
<a class="navbar-item is-tab" href=https://zmsy.co/>Home</a>
<a class="navbar-item is-tab" href=https://zmsy.co/blog>Blog</a>
<a class="navbar-item is-tab" href=https://zmsy.co/recipes>Recipes</a>
<a class="navbar-item is-tab" href=https://zmsy.co/about>About</a></div></div></nav></div></div><div id=body><div class="columns is-centered is-desktop"><div class="column is-8 is-12-touch"><section class=section><div class=blog-post><h2><a class="title title-dark blog-title is-size-1-touch" href=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/>Building Dynamic Dungeons using Unity Tilemaps</a></h2><p class=meta>written by
<a href=https://twitter.com/_zmsy>Zach Morrissey</a>
on 2019-02-11</p><figure class="color-responsive-svg hero-diamonds"><svg viewBox="0 0 834 125" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M367.37 61.19c-.76-2.1 45.86-44.42 46.4-44.08 2.37 1.48 51.98 43.68 52.07 44.08.21.94-46.95 44.13-48.74 43.85-2.41-.38-46.06-33.82-49.73-43.85zm362.5-2.59c-.12-.36 7.05-7.45 7.13-7.4.36.25 8 7.33 8 7.4.04.15-7.21 7.4-7.49 7.35-.37-.07-7.08-5.67-7.64-7.36zm69.49 1.75h1.02m-714.33-.08c-.1-.45 9.2-8.62 9.3-8.54.4.35 8.6 10.1 8.61 10.2.02.2-9.4 8.54-9.72 8.45-.43-.12-7.72-7.92-8.19-10.1zM25.7 62.26c-.38.2-1.2-.18-1.5.07-.35.27.19.73.58.34m299.45-19.82c-12.64 14.99-17.77 14.18-41.88 17.27-39.4 5.04-102.12 2.12-118.05 2.12m115.49-2.12c8.14.0 40.93.06 44.44 24.57M501.6 42.85c5.26 14.24 22.43 15.14 35.25 16.16 31.4 2.5 142.29 1.34 138.66 1.34M536.85 59c-6.7.9-31.2 14.06-35.24 26.24" fill="none" stroke="#38332a" stroke-width="20.83"/></svg></figure><div class=content><p>In one of the last projects I&rsquo;m doing for school, I&rsquo;m working on a game wherein everything in the game is <em>procedurally generated</em> using a dungeon-building algorithm.</p><h2 id=fresh-content-each-time>Fresh Content Each Time</h2><p>One of the main draws of building a <a href=https://en.wikipedia.org/wiki/Roguelike>Roguelike game</a> is figuring out how to procedurally generate dungeons. While it&rsquo;s difficult to replicate the high-quality hand-crafted content of titles like <em>Legend of Zelda: A Link to the Past</em>, you can approximate a lot of the same experience while coming up with a new layout each time the game is loaded.</p><p>Achieving this is, as you may imagine, pretty difficult.</p><p>There are a lot of resources online, but most of them follow the same pattern - create a set of rooms, connect them, place items within them. There&rsquo;s a significant amount of wiggle room within those, but that&rsquo;s the basics.</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_of_deneb_capture.png width=1042 height=611 alt="The Dungeon of Deneb logo and intro scene" loading=lazy><h2 id=unity-set-up>Unity Set Up</h2><p>The dungeon I built is based on a Unity Tilemap, which is effective a grid of 1x1 squares that you can place tiles within. For the game that I&rsquo;m working on, I made each tile 16x16 pixels (you can set them to the density that you&rsquo;re planning on making your tile sprites).</p><p>The unity objects involved:</p><ul><li>Two tilemaps (Created by Game Object > 2D Object > Tilemap). Spawning a tilemap will create a Grid object as its parent. I created two Tilemaps and connected them to the same parent. I attached my <code>Dungeon.cs</code> building script as a component to this parent.<ul><li>Floor tilemap - This is what I use to tile the floor background, and this is the main data for the dungeon layout (since walls are just created using the floor layout).</li><li>Walls (Collidable) tilemap - This one has a collider added to it, so the player can&rsquo;t walk through them.</li></ul></li><li>Tile Palette - This contains all of the floor / wall tiles that I use to build the dungeon. It&rsquo;s nice to have one of these so you can manually paint some on if you want.</li></ul><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/tile_palette.png width=312 height=370 alt='The "Dungeon Simplified" tile palette in the Unity Sidebar.' loading=lazy><h2 id=the-algorithm>The Algorithm</h2><p>Since dungeon generation algorithms can fall into a number of ways that they can end up in an infinite loop where they will <em>never</em> end up with a good dungeon layout, it&rsquo;s best to program each step of this in the following way:</p><ul><li>While not at my limit of tries</li><li>Try</li><li>If failed, reset everything and increment how many tries I&rsquo;ve done.</li></ul><h3 id=steps>Steps</h3><ol><li>Place a number of rooms in a grid.</li><li>Derive a graph for the grid. The recommended way I found to do this was to create a Delauney Triangulation. This is somewhat complicated, so it&rsquo;s recommended to <a href=http://www.personal.psu.edu/cxc11/AERSP560/DELAUNEY/13_Two_algorithms_Delauney.pdf>find an algorithm or package that will do this for you</a>.</li><li>From that graph, derive a minimum spanning tree. I found that this was easy enough to do using Prim&rsquo;s Algorithm, which is greedy and runs quickly.</li><li>Verify that the graph meets your desired gameplay goals. For me, I wanted to make sure that I had at least two non-overlapping subtrees that comprised >25% of the nodes in the tree, so that I could use these as specific gameplay areas.</li><li>Connect all the parent/child relationships in the tree with corridors.</li><li>Once that&rsquo;s done, add some optional corridors for the nodes within the same subtree, so that you can remove the perfect &ldquo;tree&rdquo;-ness of the layout and add some variety to it.</li><li>Choose a boss room. For mine, I simply chose a leaf node in the larger subtree with a higher-than-average floor area.</li><li>Choose rooms to place keys in that will open locked doors.</li><li>Lock the doors.</li><li>Place items and enemies within those rooms according to some sort of sliding difficulty scale. You can easily derive this difficulty on a number of simple heuristics (i.e. bigger room = more enemies, further depth in tree = harder enemies, etc).</li></ol><p>Go!</p><h2 id=layouts-generated>Layouts Generated</h2><p>First, a key, so you can understand what you&rsquo;re looking at:</p><ul><li>Rooms:<ul><li>Green / White = starting room / starting area</li><li>Red = boss room</li><li>Light blue = harder-than-starter area, Dark Blue = advanced area</li><li>Yellow = room with a key</li></ul></li><li>Corridors:<ul><li>White - Parent/child relationship in tree</li><li>Yellow - Optional corridor added between two rooms in the same subtree.</li></ul></li></ul><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_1.png width=627 height=419 alt="Dungeon Layout 1" loading=lazy><p>The key to the light blue area spawns in the green / white area, the key to the dark blue area spawns in the light blue area. The key to the boss room is placed within the dark blue area.</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_2.png width=649 height=489 alt="Dungeon Layout 2" loading=lazy><p>As you can see in this one, sometimes the room with a key in it spawns <em>directly</em> next to the boss (in the first example above), but sometimes it&rsquo;s located fairly far away in a different corner (in this example, on the bottom left).</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_3.png width=600 height=451 alt="Dungeon Layout 3" loading=lazy><p>In this example, I&rsquo;ve included the minimum spanning tree generated during the dungeon building process. If you note the yellow corridors between rooms, those are randomly added between rooms within the same subtree.</p><h2 id=applying-tiles>Applying Tiles</h2><p>The <a href=https://docs.unity3d.com/ScriptReference/Tilemaps.Tilemap.SetTile.html><code>TileMap.SetTile</code></a> function can then be used to programmatically fill out which tiles are supposed to go where. Once you&rsquo;ve got the room data figured out, it&rsquo;s pretty easy to determine where to set tiles (floor tiles set within any room or corridor, wall tiles set in any empty space that borders a corridor or room).</p><p>The result:</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_tiled.png width=559 height=487 alt="Dungeon Layout with tiles applied to the TileMap" loading=lazy><p>From here, you can generate the items and enemies how you see fit.</p></div></div></section></div></div></div><footer class=footer><div class="container has-text-centered"><figure class="color-responsive-svg footer-dots"><svg viewBox="0 0 262 6" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M128.2 1.1c-1.3 1.6-.5 2.6-.3 2m131.6.5c.8-.5-.6.7-1 .4-.3-.1.7-.4.5-.4M2.1 1.7c1 0 .4.2.3.4m59 .9c-.5.2 1.5-.7 1-.3m131.7-.6c0 .8-1.8 1.5-1.3 2.1.5.6 1.2-1.8 1.2-.5.0.8-2.2 1.3-2.2.5" fill="none" stroke="#faf9f9" stroke-width="2"/><path d="M61.7 1.4c-.7.8.6.3.7.5.2.4-.6 1.6-.8 1.2.0-.2.5.0.3.0m67-1.1c-.3-.8-1 1.2-1.2.3.0-.6 1.2-.5 1.3-.1.0.0-1.1.5-1.1.8M2.7 2.3c-.4.1.3 1 0 1.1-.3.2.0-1.2.3-1.2.4.0-.2.8-.4.3.0-.3.0-.8.5-.9v.5c0-.3.3-.8-.1-1-.2-.2-.3.4-.5.6-.2.0-.5-.2-.4-.4.0.0.8.3.5.7-.3.3-.5-.3-.5-.3-.2.0.0.5-.1.6-.2.2-1.2.4-.8.9.3.3.9-.9.9-.9L1.8 2s-1 .7-.7.7c.2.0.3-.6.4-.7m258.9 1.5c.5-.3-.2.3-.5.2-.2-.2-.2-.7.1-.7.5.0.0 1.4-.3 1.3-.2-.1-.2-1.2.1-1.2s.3.8.0.8c-.4.0-.5-1.1-.2-1 .2.0-.4 1-.5.9l.1-.5v.8" fill="none" stroke="#faf9f9" stroke-width="2"/></svg></figure><div id=footer-icons><a href=https://www.linkedin.com/in/zmsy><span class=icon-linkedin-square title="View my LinkedIn profile."></span></a>
<a href=https://github.com/zmsy><span class=icon-github title="Check out my Github."></span></a>
<a href=https://twitter.com/_zmsy><span class=icon-twitter title="Check out my sparsely used Twitter account."></span></a></div><p id=footer-text><strong>zmsy.co</strong> - by Zach Morrissey</p><p>Copyright Â© 2022</p></div></footer><script type=text/javascript src=https://zmsy.co/ts/index.63972e0cff68f6c041ebc75d974b38c6030a8518cf8a3883f485ec7216f414cb.js integrity="sha256-Y5cuDP9o9sBB68ddl0s4xgMKhRjPijiD9IXschb0FMs=" defer></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-104524581-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>