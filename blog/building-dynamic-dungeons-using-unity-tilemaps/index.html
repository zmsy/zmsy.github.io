<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=https://zmsy.co/><title>zmsy | Building Dynamic Dungeons using Unity Tilemaps</title><meta name=og:title content="Building Dynamic Dungeons using Unity Tilemaps"><meta name=description content="Generating a dungeon layout is both an art and a science. There's a lot of confusingly different approaches, and here's how I tackled the problem."><meta name=og:description content="Generating a dungeon layout is both an art and a science. There's a lot of confusingly different approaches, and here's how I tackled the problem."><link rel=stylesheet href=https://zmsy.co/css/main.20cfde98d93088b34d5587e963ca18edb165e6343b58ae2507b6f9e3f797badb.css integrity="sha256-IM/emNkwiLNNVYfpY8oY7bFl5jQ7WK4lB7b54/eXuts="><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css><link href="https://fonts.googleapis.com/css?family=Patua+One|Work+Sans&display=swap" rel=stylesheet><link rel=icon type=image/png href=https://zmsy.co/media/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://zmsy.co/media/favicon-16x16.png sizes=16x16><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/zmsy.co\/"},"name":"Building Dynamic Dungeons using Unity Tilemaps","headline":"Building Dynamic Dungeons using Unity Tilemaps","description":"Generating a dungeon layout is both an art and a science. There\u0027s a lot of confusingly different approaches, and here\u0027s how I tackled the problem.","inLanguage":"en-US","author":"Zach Morrissey","creator":"Zach Morrissey","publisher":"Zach Morrissey","copyrightHolder":"Zach Morrissey","copyrightYear":"2022","datePublished":"2018-01-31","dateModified":"2022-04-08T19:14:25Z","url":"https:\/\/zmsy.co\/blog\/building-dynamic-dungeons-using-unity-tilemaps\/","keywords":["Blog"]}</script></head><body><div class="columns is-centered" id=navbar-columns><div class="column is-10 is-12-touch" id=navbar-column><nav class=navbar role=navigation id=top><div class=navbar-brand><a class=navbar-item href=https://zmsy.co/><figure class="color-responsive-svg logo-img"><!doctype html><svg width="100%" height="100%" viewBox="0 0 209 209" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5"><circle cx="170.833" cy="33.333" r="33.333" style="fill:#9665c7"/><circle cx="127.778" cy="175" r="33.333" style="fill:#3a89c9"/><circle cx="37.5" cy="175" r="33.333" style="fill:#d85d44"/><circle cx="80.556" cy="33.333" r="33.333" style="fill:#fbd136"/><path d="M37.5 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M127.778 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M170.833 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M80.556 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/></svg></figure></a><a class=navbar-item href=https://zmsy.co/><div class=is-3 id=logo-text>zmsy.co</div></a><span class=navbar-burger id=navbar-toggle><span></span><span></span><span></span></span></div><div class=navbar-menu><div class=navbar-end><a class="navbar-item is-hidden-touch" href=https://www.linkedin.com/in/zmsy><span class=icon><i class="fa fa-linkedin-square" title="View my LinkedIn profile."></i></span></a><a class="navbar-item is-hidden-touch" href=https://github.com/zmsy><span class=icon><i class="fa fa-github" title="Check out my Github."></i></span></a><a class="navbar-item is-hidden-touch" href=https://twitter.com/_zmsy><span class=icon><i class="fa fa-twitter" title="Check out my sparsely used Twitter account."></i></span></a><a class="navbar-item is-tab" href=https://zmsy.co/>Home</a>
<a class="navbar-item is-tab" href=https://zmsy.co/blog>Blog</a>
<a class="navbar-item is-tab" href=https://zmsy.co/projects>Projects</a>
<a class="navbar-item is-tab" href=https://zmsy.co/about>About</a></div></div></nav></div></div><div id=body><div class="columns is-centered is-desktop"><div class="column is-8 is-12-touch"><section class=section><div class=blog-post><h2><a class="title title-dark is-size-2-touch" href=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/>Building Dynamic Dungeons using Unity Tilemaps</a></h2><p class=meta>written by
<a href=https://twitter.com/_zmsy>Zach Morrissey</a>
on 2019-02-11</p><figure class="color-responsive-svg hero-diamonds"><svg viewBox="0 0 140 30" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.41"><path d="M24.21 14.6 13.61 4 3 14.6l10.6 10.61 10.61-10.6zm28 0L41.61 4 31 14.6l10.6 10.61 10.61-10.6zm28 0L69.61 4 59 14.6l10.6 10.61 10.61-10.6zm28 0L97.61 4 87 14.6l10.6 10.61 10.61-10.6zm29 0L126.61 4 116 14.6l10.6 10.61 10.61-10.6z" style="fill:#38332a"/></svg></figure><div class=content><p>In one of the last projects I&rsquo;m doing for school, I&rsquo;m working on a game wherein everything in the game is <em>procedurally generated</em> using a dungeon-building algorithm.</p><h2 id=fresh-content-each-time>Fresh Content Each Time</h2><p>One of the main draws of building a <a href=https://en.wikipedia.org/wiki/Roguelike>Roguelike game</a> is figuring out how to procedurally generate dungeons. While it&rsquo;s difficult to replicate the high-quality hand-crafted content of titles like <em>Legend of Zelda: A Link to the Past</em>, you can approximate a lot of the same experience while coming up with a new layout each time the game is loaded.</p><p>Achieving this is, as you may imagine, pretty difficult.</p><p>There are a lot of resources online, but most of them follow the same pattern - create a set of rooms, connect them, place items within them. There&rsquo;s a significant amount of wiggle room within those, but that&rsquo;s the basics.</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_of_deneb_capture.png alt="The Dungeon of Deneb logo and intro scene"><h2 id=unity-set-up>Unity Set Up</h2><p>The dungeon I built is based on a Unity Tilemap, which is effective a grid of 1x1 squares that you can place tiles within. For the game that I&rsquo;m working on, I made each tile 16x16 pixels (you can set them to the density that you&rsquo;re planning on making your tile sprites).</p><p>The unity objects involved:</p><ul><li>Two tilemaps (Created by Game Object > 2D Object > Tilemap). Spawning a tilemap will create a Grid object as its parent. I created two Tilemaps and connected them to the same parent. I attached my <code>Dungeon.cs</code> building script as a component to this parent.<ul><li>Floor tilemap - This is what I use to tile the floor background, and this is the main data for the dungeon layout (since walls are just created using the floor layout).</li><li>Walls (Collidable) tilemap - This one has a collider added to it, so the player can&rsquo;t walk through them.</li></ul></li><li>Tile Palette - This contains all of the floor / wall tiles that I use to build the dungeon. It&rsquo;s nice to have one of these so you can manually paint some on if you want.</li></ul><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/tile_palette.png alt='The "Dungeon Simplified" tile palette in the Unity Sidebar.'><h2 id=the-algorithm>The Algorithm</h2><p>Since dungeon generation algorithms can fall into a number of ways that they can end up in an infinite loop where they will <em>never</em> end up with a good dungeon layout, it&rsquo;s best to program each step of this in the following way:</p><ul><li>While not at my limit of tries</li><li>Try</li><li>If failed, reset everything and increment how many tries I&rsquo;ve done.</li></ul><h3 id=steps>Steps</h3><ol><li>Place a number of rooms in a grid.</li><li>Derive a graph for the grid. The recommended way I found to do this was to create a Delauney Triangulation. This is somewhat complicated, so it&rsquo;s recommended to <a href=http://www.personal.psu.edu/cxc11/AERSP560/DELAUNEY/13_Two_algorithms_Delauney.pdf>find an algorithm or package that will do this for you</a>.</li><li>From that graph, derive a minimum spanning tree. I found that this was easy enough to do using Prim&rsquo;s Algorithm, which is greedy and runs quickly.</li><li>Verify that the graph meets your desired gameplay goals. For me, I wanted to make sure that I had at least two non-overlapping subtrees that comprised >25% of the nodes in the tree, so that I could use these as specific gameplay areas.</li><li>Connect all the parent/child relationships in the tree with corridors.</li><li>Once that&rsquo;s done, add some optional corridors for the nodes within the same subtree, so that you can remove the perfect &ldquo;tree&rdquo;-ness of the layout and add some variety to it.</li><li>Choose a boss room. For mine, I simply chose a leaf node in the larger subtree with a higher-than-average floor area.</li><li>Choose rooms to place keys in that will open locked doors.</li><li>Lock the doors.</li><li>Place items and enemies within those rooms according to some sort of sliding difficulty scale. You can easily derive this difficulty on a number of simple heuristics (i.e. bigger room = more enemies, further depth in tree = harder enemies, etc).</li></ol><p>Go!</p><h2 id=layouts-generated>Layouts Generated</h2><p>First, a key, so you can understand what you&rsquo;re looking at:</p><ul><li>Rooms:<ul><li>Green / White = starting room / starting area</li><li>Red = boss room</li><li>Light blue = harder-than-starter area, Dark Blue = advanced area</li><li>Yellow = room with a key</li></ul></li><li>Corridors:<ul><li>White - Parent/child relationship in tree</li><li>Yellow - Optional corridor added between two rooms in the same subtree.</li></ul></li></ul><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_1.png alt="Dungeon Layout 1"><p>The key to the light blue area spawns in the green / white area, the key to the dark blue area spawns in the light blue area. The key to the boss room is placed within the dark blue area.</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_2.png alt="Dungeon Layout 2"><p>As you can see in this one, sometimes the room with a key in it spawns <em>directly</em> next to the boss (in the first example above), but sometimes it&rsquo;s located fairly far away in a different corner (in this example, on the bottom left).</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_3.png alt="Dungeon Layout 3"><p>In this example, I&rsquo;ve included the minimum spanning tree generated during the dungeon building process. If you note the yellow corridors between rooms, those are randomly added between rooms within the same subtree.</p><h2 id=applying-tiles>Applying Tiles</h2><p>The <a href=https://docs.unity3d.com/ScriptReference/Tilemaps.Tilemap.SetTile.html><code>TileMap.SetTile</code></a> function can then be used to programmatically fill out which tiles are supposed to go where. Once you&rsquo;ve got the room data figured out, it&rsquo;s pretty easy to determine where to set tiles (floor tiles set within any room or corridor, wall tiles set in any empty space that borders a corridor or room).</p><p>The result:</p><img src=https://zmsy.co/blog/building-dynamic-dungeons-using-unity-tilemaps/dungeon_layout_tiled.png alt="Dungeon Layout with tiles applied to the TileMap"><p>From here, you can generate the items and enemies how you see fit.</p></div></div></section></div></div></div><footer class=footer><div class="container has-text-centered"><p><figure class="color-responsive-svg footer-dots"><svg viewBox="0 0 262 6" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M128.2 1.1c-1.3 1.6-.5 2.6-.3 2m131.6.5c.8-.5-.6.7-1 .4-.3-.1.7-.4.5-.4M2.1 1.7c1 0 .4.2.3.4m59 .9c-.5.2 1.5-.7 1-.3m131.7-.6c0 .8-1.8 1.5-1.3 2.1.5.6 1.2-1.8 1.2-.5.0.8-2.2 1.3-2.2.5" fill="none" stroke="#faf9f9" stroke-width="2"/><path d="M61.7 1.4c-.7.8.6.3.7.5.2.4-.6 1.6-.8 1.2.0-.2.5.0.3.0m67-1.1c-.3-.8-1 1.2-1.2.3.0-.6 1.2-.5 1.3-.1.0.0-1.1.5-1.1.8M2.7 2.3c-.4.1.3 1 0 1.1-.3.2.0-1.2.3-1.2.4.0-.2.8-.4.3.0-.3.0-.8.5-.9v.5c0-.3.3-.8-.1-1-.2-.2-.3.4-.5.6-.2.0-.5-.2-.4-.4.0.0.8.3.5.7-.3.3-.5-.3-.5-.3-.2.0.0.5-.1.6-.2.2-1.2.4-.8.9.3.3.9-.9.9-.9L1.8 2s-1 .7-.7.7c.2.0.3-.6.4-.7m258.9 1.5c.5-.3-.2.3-.5.2-.2-.2-.2-.7.1-.7.5.0.0 1.4-.3 1.3-.2-.1-.2-1.2.1-1.2s.3.8.0.8c-.4.0-.5-1.1-.2-1 .2.0-.4 1-.5.9l.1-.5v.8" fill="none" stroke="#faf9f9" stroke-width="2"/></svg></figure></p><p id=footer-text><strong>zmsy.co</strong> - by Zach Morrissey</p><p>Copyright © 2022</p></div></footer><script type=text/javascript src=https://zmsy.co/ts/index.2b7b95ede0f1ad83b7a212be597766dc2b24b5ced70c166862a14acfa0a4ba2a.js integrity="sha256-K3uV7eDxrYO3ohK+WXdm3Csktc7XDBZoYqFKz6Ckuio=" defer></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-104524581-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>