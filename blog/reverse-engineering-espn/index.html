<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us class=is-clipped><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=https://zmsy.co/><title>zmsy | Reverse Engineering Anomalous Stats in ESPN Fantasy Baseball</title><meta name=og:title content="Reverse Engineering Anomalous Stats in ESPN Fantasy Baseball"><meta name=description content="Using some minor sleuthing and publicly available information, I investigated why ESPN's calculation used for Runs Created was producing weird outputs."><meta name=og:description content="Using some minor sleuthing and publicly available information, I investigated why ESPN's calculation used for Runs Created was producing weird outputs."><meta name=theme-color content="#3a89c9"><link rel=preload href=https://zmsy.co/fonts/patua-one/patua-one-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://zmsy.co/fonts/work-sans/work-sans-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><style>@font-face{font-family:patua one;font-weight:400;font-display:block;src:url(/fonts/patua-one/patua-one-latin-400-normal.woff2)format("woff2"),url(/fonts/patua-one/patua-one-latin-400-normal.woff)format("woff")}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-400-normal.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-ext-400-normal.woff2)format("woff2");unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:work sans;font-style:italic;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-400-italic.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:italic;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-ext-400-italic.woff2)format("woff2");unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:700;src:url(/fonts/work-sans/work-sans-latin-700-normal.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:700;src:url(/fonts/work-sans/work-sans-latin-ext-700-normal.woff2)format("woff2");unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:icomoon;src:url(/fonts/icomoon/icomoon.eot);src:url(/fonts/icomoon/icomoon.eot)format("embedded-opentype"),url(/fonts/icomoon/icomoon.ttf)format("truetype"),url(/fonts/icomoon/icomoon.woff)format("woff"),url(/fonts/icomoon/icomoon.svg)format("svg");font-weight:400;font-style:normal;font-display:block}[class^=icon-],[class*=" icon-"]{font-family:icomoon!important;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-heart:before{content:"\f004"}.icon-star:before{content:"\f005"}.icon-check:before{content:"\f00c"}.icon-close:before{content:"\f00d"}.icon-remove:before{content:"\f00d"}.icon-times:before{content:"\f00d"}.icon-external-link:before{content:"\f08e"}.icon-cut:before{content:"\f0c4"}.icon-scissors:before{content:"\f0c4"}.icon-copy:before{content:"\f0c5"}.icon-files-o:before{content:"\f0c5"}.icon-caret-down:before{content:"\f0d7"}.icon-caret-up:before{content:"\f0d8"}.icon-caret-left:before{content:"\f0d9"}.icon-caret-right:before{content:"\f0da"}.icon-cloud-download:before{content:"\f0ed"}.icon-chevron-circle-up:before{content:"\f139"}.icon-chevron-circle-down:before{content:"\f13a"}.icon-sliders:before{content:"\f1de"}.icon-spotify:before{content:"\e900"}.icon-envelope:before{content:"\e901"}.icon-github:before{content:"\e902"}.icon-twitter:before{content:"\e903"}.icon-linkedin-square:before{content:"\e904"}.icon-paw:before{content:"\e905"}</style><link rel=stylesheet href=https://zmsy.co/css/main.0b791d6e931d8b609742f0397b9d16c16018756c3efe421d207bdc679fc0c0ab.css integrity="sha256-C3kdbpMdi2CXQvA5e50WwWAYdWw+/kIdIHvcZ5/AwKs="><link rel=icon type=image/png href=https://zmsy.co/media/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://zmsy.co/media/favicon-16x16.png sizes=16x16><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/zmsy.co\/"},"name":"Reverse Engineering Anomalous Stats in ESPN Fantasy Baseball","headline":"Reverse Engineering Anomalous Stats in ESPN Fantasy Baseball","description":"Using some minor sleuthing and publicly available information, I investigated why ESPN\u0027s calculation used for Runs Created was producing weird outputs.","inLanguage":"en-US","author":"Zach Morrissey","creator":"Zach Morrissey","publisher":"Zach Morrissey","copyrightHolder":"Zach Morrissey","copyrightYear":"2022","datePublished":"2018-01-31","dateModified":"2022-08-25T01:15:26Z","url":"https:\/\/zmsy.co\/blog\/reverse-engineering-espn\/","keywords":["Blog"]}</script></head><body><div id=nav-modal></div><div class="columns is-centered" id=navbar-columns><div class="column is-10 is-12-touch" id=navbar-column><nav class=navbar role=navigation id=top><div class=navbar-brand><a class=navbar-item href=https://zmsy.co/><figure class="color-responsive-svg logo-img"><!doctype html><svg width="100%" height="100%" viewBox="0 0 209 209" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5"><circle cx="170.833" cy="33.333" r="33.333" style="fill:#9665c7"/><circle cx="127.778" cy="175" r="33.333" style="fill:#3a89c9"/><circle cx="37.5" cy="175" r="33.333" style="fill:#d85d44"/><circle cx="80.556" cy="33.333" r="33.333" style="fill:#fbd136"/><path d="M37.5 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M127.778 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M170.833 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M80.556 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/></svg></figure></a><a class=navbar-item href=https://zmsy.co/><div class=is-3 id=logo-text>zmsy.co</div></a><span class=navbar-burger id=navbar-toggle><span></span>
<span></span>
<span></span></span></div><div class=navbar-menu><div class=navbar-end><a class="navbar-item is-hidden-mobile" href=https://www.linkedin.com/in/zmsy><span class=icon-linkedin-square title="View my LinkedIn profile."></span></a>
<a class="navbar-item is-hidden-mobile" href=https://github.com/zmsy><span class=icon-github title="Check out my Github."></span></a>
<a class="navbar-item is-hidden-mobile" href=https://twitter.com/_zmsy><span class=icon-twitter title="Check out my sparsely used Twitter account."></span></a>
<a class="navbar-item is-tab" href=https://zmsy.co/>Home</a>
<a class="navbar-item is-tab" href=https://zmsy.co/blog>Blog</a>
<a class="navbar-item is-tab" href=https://zmsy.co/recipes>Recipes</a>
<a class="navbar-item is-tab" href=https://zmsy.co/about>About</a></div></div></nav></div></div><div id=body><div class="columns is-centered is-desktop"><div class="column is-8 is-12-touch"><section class=section><div class=blog-post><h2><a class="title title-dark blog-title is-size-1-touch" href=https://zmsy.co/blog/reverse-engineering-espn/>Reverse Engineering Anomalous Stats in ESPN Fantasy Baseball</a></h2><p class=meta>written by
<a href=https://twitter.com/_zmsy>Zach Morrissey</a>
on 2022-04-28</p><figure class="color-responsive-svg hero-diamonds"><svg viewBox="0 0 834 125" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M367.37 61.19c-.76-2.1 45.86-44.42 46.4-44.08 2.37 1.48 51.98 43.68 52.07 44.08.21.94-46.95 44.13-48.74 43.85-2.41-.38-46.06-33.82-49.73-43.85zm362.5-2.59c-.12-.36 7.05-7.45 7.13-7.4.36.25 8 7.33 8 7.4.04.15-7.21 7.4-7.49 7.35-.37-.07-7.08-5.67-7.64-7.36zm69.49 1.75h1.02m-714.33-.08c-.1-.45 9.2-8.62 9.3-8.54.4.35 8.6 10.1 8.61 10.2.02.2-9.4 8.54-9.72 8.45-.43-.12-7.72-7.92-8.19-10.1zM25.7 62.26c-.38.2-1.2-.18-1.5.07-.35.27.19.73.58.34m299.45-19.82c-12.64 14.99-17.77 14.18-41.88 17.27-39.4 5.04-102.12 2.12-118.05 2.12m115.49-2.12c8.14.0 40.93.06 44.44 24.57M501.6 42.85c5.26 14.24 22.43 15.14 35.25 16.16 31.4 2.5 142.29 1.34 138.66 1.34M536.85 59c-6.7.9-31.2 14.06-35.24 26.24" fill="none" stroke="#38332a" stroke-width="20.83"/></svg></figure><div class=content><p><strong>&ldquo;Runs Created&rdquo;</strong> (RC) is an arbitrary, but useful, metric created by baseball stat wizard <a href=https://www.baseball-reference.com/bullpen/Bill_James>Bill James</a> that <a href=https://www.baseball-reference.com/bullpen/Runs_created>dates back to the 1970s</a>. It has a <a href=https://captaincalculator.com/sports/baseball/runs-created-calculator/>variety of formulas</a> that can be used.</p><p>Why care about it? Like WAR, RC is effectively a way to derive a <strong>useful absolute number reflective of a batter&rsquo;s overall offensive productivity</strong>. Since the <em>actual</em> positive numbers in baseball can be misleading (RBI, R, SB, H) in some scenarios, it&rsquo;s a nice way of smoothing over small sample sizes.</p><p>Here&rsquo;s the concept of it, at it&rsquo;s most basic form:</p><ul><li><strong>A</strong> - On base factor - How well did you, as a batter, reach base?</li><li><strong>B</strong> - Advancement factor - How well did you advance as a runner, or advanced other runners?</li><li><strong>C</strong> - Opportunity factor - The total opportunities given to do well in A or B</li></ul><p>Plugging those in, <strong>Runs Created = (A + B) / C</strong>.</p><p>We love it in my fantasy baseball league as a primary indicator of your team&rsquo;s offensive performance. If nothing else because <a href=https://library.fangraphs.com/offense/wrc/>FanGraph&rsquo;s wRC+ stats</a> is our preferred way of judging batters overall value. It&rsquo;s &ldquo;Weight Runs Created+&rdquo;, meaning that it&rsquo;s a <a href=https://www.mlb.com/glossary/advanced-stats/weighted-runs-created-plus>version of Runs Created weight for external factors like field or year</a> and inflated such that the league mean is 100. An RC of over 100 implies an above average hitter (and vice versa).</p><h2 id=somethings-not-right-here>Something&rsquo;s&mldr; Not Right Here</h2><p>There really aren&rsquo;t that many things I can say are consistent between the different derivations of the stat, but the one obvious quality constraint: <strong>Runs Created should never be negative.</strong> Creating a run, which is a positive integer, seems like it should preclude that.</p><p>So you can imagine my surprise to see my sure-to-turn-it-around-someday-soon team member Christian Yelich with <code>-.2</code> in his RC column for the past 7 days. What the heck? Sure he&rsquo;s having a rough year (alright, three years), but he&rsquo;s certainly not <em>subtracting runs from his team</em>. As far as I know, baseball runs never go below zero. Put baseball-inept me in the batter&rsquo;s box to face 98mph heaters and I still wouldn&rsquo;t be able to accomplish that.</p><img src=https://zmsy.co/blog/reverse-engineering-espn/phonea-negative-rc.png width=750 height=461 alt loading=lazy><p>My feeble attempts tweeting at ESPN&rsquo;s customer service line didn&rsquo;t seem to be escalating in time for this to not affect our season, so I decided to figure out for myself <em>why</em> this was wrong and provide them with the most precise reproduction of how their current RC derivation is off.</p><p>I&rsquo;m taking the assumption here that 1. there is a single RC formula at ESPN and 2. it&rsquo;s used for both single-day and aggregate stats. Given my history of observing it through the several years that I&rsquo;ve played fantasy baseball, this seems like a fair set of assumptions.</p><h2 id=sleuthing-part-1---what-info-is-available>Sleuthing, Part 1 - What Info is Available?</h2><p>Since RC isn&rsquo;t explicitly defined, it&rsquo;s hard for me to supervise this effort: I&rsquo;m not fully certain what the outcome of the calculation <em>should</em> be. I can tell in some ways what it should <em>not</em> be, but that&rsquo;s it. So I&rsquo;ve got a few questions to answer:</p><ol><li>What formula is ESPN <em>currently</em> using to derive RC?</li><li>Is the derivation wrong, or is the wrong data being passed to it?</li></ol><h4 id=corroborating-the-result-displayed-in-espn>Corroborating the Result Displayed in ESPN</h4><p>Ideally, I want to find some statistics from other websites (ESPN&rsquo;s display doesn&rsquo;t show most of the values that it uses as calculation arguments), so I&rsquo;ll use stats on a defined time period: The season so far, as of end-of-day 2022-04-27.</p><p><a href="https://www.fangraphs.com/leaders.aspx?pos=all&stats=bat&lg=all&qual=y&type=0&season=2022&month=1000&season1=2022&ind=0&team=23&rost=0&age=0&filter=&players=0&startdate=2022-03-01&enddate=2022-04-27">Christian Yelich 2022 Season Stats (Through 4/28)</a></p><table><thead><tr><th>G</th><th>AB</th><th>PA</th><th>H</th><th>1B</th><th>2B</th><th>3B</th><th>HR</th><th>R</th><th>TB</th></tr></thead><tbody><tr><td>18</td><td>65</td><td>76</td><td>12</td><td>7</td><td>4</td><td>0</td><td>1</td><td>8</td><td>19</td></tr></tbody></table><table><thead><tr><th>RBI</th><th>BB</th><th>IBB</th><th>SO</th><th>HBP</th><th>SF</th><th>SH</th><th>GDP</th><th>SB</th><th>CS</th></tr></thead><tbody><tr><td>8</td><td>8</td><td>0</td><td>19</td><td>1</td><td>2</td><td>0</td><td>0</td><td>2</td><td>0</td></tr></tbody></table><p>Current RC value shown in ESPN, as of morning of 4/28 (No games played yet today): <strong>5.9 Runs Created</strong></p><img src=https://zmsy.co/blog/reverse-engineering-espn/phoneb-team-page-current-total.png width=750 height=401 alt loading=lazy><p>However, navigating to the player page in ESPN (again, as of morning 4/28), I&rsquo;m being shown something different: <strong>6.3 Runs Created</strong></p><img src=https://zmsy.co/blog/reverse-engineering-espn/a-yelich_career_rc.png width=343 height=342 alt loading=lazy><p>So this means my original assumptions of a single, universal derivation for RC are incorrect. Which gives me hope! The second one displayed here <em>may</em> be more correct than this first one.</p><h3 id=calculating-using-existing-rc-formulas>Calculating Using Existing RC Formulas</h3><p>There&rsquo;s a handful of different RC formulas available online, so let&rsquo;s plug these numbers in to see what we&rsquo;ll get. These formulas are from <a href=https://www.baseball-reference.com/about/bat_glossary.shtml>Baseball Reference&rsquo;s acronyms page</a>, but I&rsquo;ve used the full terms below so things are slightly clearer. If you&rsquo;re confused by any of the terms used, <a href=https://abbreviations.yourdictionary.com/articles/basic-baseball-stats-abbreviations.html>Baseball Reference has a handy glossary</a>.</p><p>I&rsquo;ve calculated these using the as-of-today stats from Fangraphs above, and truncated the precision of each.</p><h4 id=basic-version>Basic Version</h4><p>This is a simple approach, using only a few common metrics.</p><pre tabindex=0><code>Formula:
RC = ((Hits + Walks) x Total Bases) ÷ (At Bats + Walks)

Calculation:
((12 + 8) x 19) ÷ (65 + 8) 
</code></pre><p>Output: <strong>5.2 Runs Created</strong></p><p>There&rsquo;s also the &ldquo;Baseball Reference&rdquo; flavor of the basic version here, which takes Hit By Pitch & Sacrifice Fly into account:</p><pre tabindex=0><code>Formula:
RC = ((Hits + Walks + Hit by Pitch) x Total Bases) ÷ (At Bats + Walks + Hit By Pitch + SF)

Calculation:
RC = ((12 + 8 + 1) x 19) ÷ (65 + 8 + 1 + 2) 
</code></pre><p>Output: <strong>5.3 Runs Created</strong></p><h4 id=stolen-bases-method>Stolen Bases Method</h4><p>Another fallback method used where only some data is available.</p><pre tabindex=0><code>Formula:
((Hits + Walks – Caught Stealing) x (Total Bases + (0.55 x Stolen Bases))) ÷ (At Bats + Walks)

Calculation:
RC = (((12 + 8 - 0) x (19 + (0.55 * 2))) ÷ (65 + 8) 
</code></pre><p>Output: <strong>5.5 Runs Created</strong></p><h4 id=baseball-reference-canonical-version-aka-technical-method>Baseball Reference Canonical Version (a.k.a. &ldquo;Technical Method&rdquo;)</h4><p>This is the Baseball Reference preferred method where data is available. Considering baseball data is available on their site for something on the order of 130 years, this is not always the case. If you look at the arguments being passed here, this is slightly expanded version of the &ldquo;Stolen Bases&rdquo; method above.</p><pre tabindex=0><code>Formula:
Let A = (Hits + Walks – Caught Stealing + Hit by Pitch – Ground into Double Play)
Let B = (0.26 x (Walks – Intentional Walks + Hit by Pitch))
Let C = (0.52 * (Sacrifice Hits + Sacrifice Flies + Stolen Bases))
Let D = (At Bats + Walks + Hit by Pitch + Sacrifice Hits + Sacrifice Flies)
RC = (A x (Total Bases + B + C)) ÷ D

Calculation:
A = (12 + 8 - 0 + 1 - 2) = 19
B = (0.26 * (8 - 0 + 1)) = 2.34
C = (0.52 x (0 + 2 + 2)) = 2.08
D = (65 + 8 + 1 + 0 + 2) = 76
RC = (19 * (19 + 2.34 + 2.08)) / 76
</code></pre><p>Output: <strong>5.8 Runs Created</strong></p><h4 id=2002-method>2002 Method</h4><p>This is another flavor of the &ldquo;Technical&rdquo; method defined above:</p><pre tabindex=0><code>Formula:
Let A = Hits + Walks – Caught Stealing + Hit by Pitch – Ground Into Double Play
Let B = (1.125 x Singles) + (1.69 x Doubles) + (3.02 x Triples) + (3.73 x Home Runs)
        + (0.29 x (Walks – Intentional Walks + Hit by Pitch))
        + (0.492 x (Sacrifice Hits + Sacrifice Flies + Stolen Bases))
        – (0.4 x Strikeouts)
Let C = At Bats + Walks + Hit by Pitch + Sacrifice Hits + Sacrifice Flies
Let D = ((2.4 x C) + A) x ((3 x C) + B))
RC = (D ÷ (9 x C)) – (0.9 x C)

Calculation:
Let A = 12 + 8 – 0 + 1 – 0 = 21
Let B = (1.125 x 7) + (1.69 x 4) + (3.02 x 0) + (3.73 x 1)
        + (0.29 x (8 – 0 + 1))
        + (0.492 x (0 + 2 + 2))
        – (0.4 x 19) = 22.183
Let C = 65 + 8 + 1 + 0 + 2 = 76
Let D = ((2.4 x C) + A) x ((3 x C) + B)) = 50,887.2
RC = (49,495.97 ÷ (9 x 76)) – (0.9 x 76)
</code></pre><p>Output: <strong>5.99 Runs Created</strong></p><h2 id=sleuthing-part-2---react-devtools--api-response-investigations>Sleuthing, Part 2 - React DevTools + API Response Investigations</h2><p>Since I&rsquo;m primarily a fullstack web developer these days, felt natural to try next to see if I could just debug this like something I&rsquo;d debug on one of my own websites. So first thing I did was open Firefox Developer Tools and check to see if the page is using React or some similar framework that I can look into.</p><p>Bam, the page is rendered using React.</p><img src=https://zmsy.co/blog/reverse-engineering-espn/b-react_devtools.png width=755 height=367 alt loading=lazy><p>Navigating to the individual cell being rendered and&mldr;</p><figure class=color-responsive-svg style=height:15rem><svg viewBox="0 0 1540 850" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M315.15 279.7c0-40.34-169.15-178.62-161.14-185.62 2.93-2.56 370.99 134.61 376.05 130.68 4.43-3.45 160.37-151.89 186.9-168.18 3.62-2.23 136.96 129.67 137.36 127.7.92-4.45 384.24-138.03 439.01-171.77 2.75-1.7-35.31 290.92-38.1 288.1-9.47-9.6 261.8 69.85 271.7 64.25 3.38-1.91-271.84 150.31-271.7 156.14.42 19.14 153.7 241.16 134.2 235-9.78-3.09-472.23-168.25-500.93-176.81-2.37-.7-107.5 259.35-109.23 257.76-17.92-16.46-122.93-211.56-138.1-198.99-6.33 5.24-224.62 176.8-229.6 184.7-1.09 1.73 1.95-182.25 1.95-231.87.0-2.36-368.65 114.67-400.9 115.02-5.63.06 193.64-206.2 261.99-242.15 2.05-1.08-170.21-114.16-167.38-143.56 1.62-16.86 207.92-40.4 207.92-40.4zm34.93 274.23c-6.08-27.68 713.62-83.73 815.45.0" fill="none" stroke="#38332a" stroke-width="25"/><g fill="none" stroke="#38332a"><path d="M355.16 270.12s142-12.8 152.52 4.17c48.74 78.58-5.69 68.14-6.86 93.02-.34 7.14 50.04 42.24 23.04 89.24-23.25 40.44-155.97 32.5-157.87 28.23-3.24-7.3-5.34-43.71-4.02-41.56.5.82 15.04.23 15.06-.42 1.2-33.26 5.57-119.8 5.21-119.35-.41.52-23.14-8.35-28.4-11.75-2.47-1.6 1.31-42.33 1.32-41.58z" stroke-width="16.67"/><path d="M420.16 299.95l.7 56.09s55.09 3.71 54.92-30.33c-.15-32.61-55.62-25.76-55.62-25.76zm1.15 92.39c.14 10.81 12.25 55.94 12.25 55.94s49.17-7.76 49.15-30.25c-.03-32.61-61.4-25.69-61.4-25.69z" stroke-width="12.5"/><path d="M580.38 337.15c10.95-10.08 61-16.24 68.94-12.89 46.27 19.54 65.7 89.04 33.53 136.86-17.37 25.83-84.31 25.27-106.9 1.33-34.98-37.06-29.53-94.05 4.43-125.3zm167.58 123.02c10.76 9.8 53.2 14.81 66.52 11.2 46.87-12.74 60.91-90.62 28.85-137.64-17.32-25.4-81.58-23.2-102.7 1.28-32.67 37.91-26.04 94.74 7.33 125.16z" stroke-width="16.67"/><path d="M626.38 445.72c-25.48 4-29.97-59.09-29.68-64.05 1.24-21.36 26.76-27.53 33.96-21.36 8 6.85 17.34 26.8 19.95 35.88 2.85 9.92 13.21 43.67-24.23 49.53zm172.74-8.7c25.71-1.97 15.56-64.4 14.14-69.16-6.12-20.5-32.38-20.63-37.97-12.97-6.2 8.5-10.7 30.07-11.15 39.5-.5 10.31-2.81 45.54 34.98 42.63zm79.47-120.01c4.34-.05 48.44-2.57 52-2.02 1.07.17 2.23 11.75.87 14.02-.39.64 26.82-21.75 44.05-21.94 22.6-.25 41.88 14.98 42.3 14.91 5.87-.85 22.83-11.74 33.1-15.85 8.56-3.44 41.72-4.42 46.76 2.69 18.77 26.42 18.1 115.73 19.2 118.21.26.62 10.16-.98 11.76-.29 11.12 4.83 9.8 31.86 8.7 34.37-.87 2-70 3.31-70.36 2.84-1.16-1.48-1.49-23.4-1.69-24.5-.59-3.22 11.95-16.92 12.15-17.88.77-3.59-.93-53.84-1.78-63.85-.1-1.28-22.94-13.71-28.31-12.62-17.75 3.6-19.58 22.95-19.66 36.8-.02 3.74 1.5 43.62 2.58 47.03 3.72 11.7 12.7 7.26 13.9 14.12.3 1.7-.85 15.96-1.8 17.46-1.11 1.74-63.73.56-67.77 2.25-.1.04.44-23.3 3.04-25.46 2.5-2.06 12.39 1.7 14.36-2.56 1.14-2.46-2.78-73.42-3.86-76.6-.4-1.16-22.63-12.61-27.27-12.28-4.65.34-10.81 8.5-13.23 11.86-12.41 17.25-11.2 71.68-11.04 72.02.72 1.56 10.81 5.64 14.48 8.65 2.12 1.74 2.74 16.9-4.07 24.03-1.23 1.28-51.68 3.89-55.68 2.71-1.49-.43-9.3-17.44-9.35-21.62-.01-1.16 12.57-1.98 16.08-4.46 1.1-.78-2.7-77.01-3.46-83.86.0-.12-9.88.32-10.26.13-6.86-3.55-5.74-38.3-5.74-38.3zm282.02-68.24c14.4-.18 35.27-3.2 36.86-.46 7.01 12.12 4.21 134.84 1.75 140.31-1.24 2.77-28.67 9.17-30.77 7.98-8.22-4.64-13.14-82.34-7.84-147.83zm6.87 183.78c2.86-15.92 29.81-18.95 35.26-12.25 19.73 24.29 6.83 45.94-14.87 46.47-25.32.62-21.68-27.07-20.39-34.22z" stroke-width="14.58"/></g><path d="M215.52 359.48c22.19.0 47.24 8.6 67.17 18.26 10.96 5.31 10.57 5.32 20.82 11.23 4.99 2.88 7.36 4.37 12.1 6.67 1.48.72 4.6 3.43 4.6 1.78m922.38 22.23c14.18-1.62 65.73-21.7 104.68-21.7m-286.41-194.89c16.62-5.31 77.06-71.3 122.73-71.3M491.27 590.42c12.5 13.47 4.16 27.77 4.16 37.08.0.95 76.6-37.08 79.85-37.08m145.85 6.96c9.11 5.28 50.04 53.46 51.76 55.99 3.44 5.04 8.74-57.43 41.16-90.99m-130.6-323.99c6.7-8.14 28.21-67.57 28.94-70.55 1.46-5.92 28.25 50.76 70.36 70.88m362.66 381.08c33.44.48 70.93 18.39 76.32 27.27.47.78-8.74-29.18-8.74-39.13m-939.02-72.07c-6.09 8.44-22.42 59.9-19.02 55.73 3.53-4.3 49.8-8.84 65.25-6.24" fill="none" stroke="#38332a" stroke-width="14.58"/></svg></figure><p><strong>There it is.</strong></p><img src=https://zmsy.co/blog/reverse-engineering-espn/c-team_page_devtools.png width=760 height=455 alt loading=lazy><p>They pass the actual derivation formula to the individual table cell as props, and the calculation is run on the client. We&rsquo;ve got the actual formula they&rsquo;re using now, so time to see where it&rsquo;s going wrong.</p><p>As one other curiosity, can we figure out where that other number, <code>6.3</code> on the player page was coming from?</p><p>Let me check <a href=https://www.espn.com/mlb/player/stats/_/id/31283/christian-yelich>Yelich&rsquo;s individual player page in ESPN</a>&mldr;</p><img src=https://zmsy.co/blog/reverse-engineering-espn/d-yelich_player_page_devtools.png width=343 height=342 alt loading=lazy><p>Bummer. Unfortunately, this one is just passed as a value and there&rsquo;s no derivation on it. Turns out there&rsquo;s a MobX store on this page that&rsquo;s open to investigation, but unfortunately it doesn&rsquo;t contain anything other than values. No derivation formula. I&rsquo;m guessing that these formulas are calculated server-side for this page.</p><h3 id=runs-created-espn-version>Runs Created, ESPN Version</h3><p>Formula, directly from ESPN&rsquo;s app:</p><pre tabindex=0><code>((a + b - c - d + 2.4 * (e + b + f)) *
  (g + b * 0.26 + f * 0.53 + h * 0.64 - i * 0.03 + 3 * (e + b + f))) /
  (9 * (e + b + f)) - 0.9 * (e + b + f)
</code></pre><p>Just by looking at the coefficients in use here, it seems this is a variation on the <a href=https://en.wikipedia.org/wiki/Runs_created#2002_version_of_runs_created>2002 formulation of RC</a>.</p><p>Formatting this to look more like the official calculation above:</p><pre tabindex=0><code>A = a + b - c - d
B = g + (b * 0.26) + (f * 0.53) + (h * 0.64) - (i * 0.03)
C = e + b + f
D = ((2.4 * C) + A) x ((3 * C) + B))
RC = (D ÷ (9 x C)) – (0.9 x C)
</code></pre><p>So we&rsquo;ve <strong>got the formula</strong> now. Nice!</p><p>&mldr;but the <strong>arguments are anonymous</strong>. I&rsquo;m not sure, from looking at them, what any of the variables here are used for. Complicating this slightly further? It looks like the argument <em>values</em> are the exact same for every single cell, regardless of the outcome.</p><img src=https://zmsy.co/blog/reverse-engineering-espn/f-same-formula-arguments.png width=517 height=186 alt loading=lazy><p>When I look at the arguments here for Yelich, it seems to be the same set of values passed as arguments for every player. So how, with the same inputs, are we getting separate outputs? Runs Created is, in all of its derivations, a deterministic formula.</p><h4 id=what-are-these-arguments>What Are These Arguments?</h4><p>Let&rsquo;s go back to the React DevTools for a moment to see if there&rsquo;s any information we can gather.</p><p>Inspecting further, it looks like we&rsquo;ve got an entry called <code>rawStats</code> array with keys that look <em>exactly</em> like those argument mappings from before.</p><img src=https://zmsy.co/blog/reverse-engineering-espn/k-raw-stats.png width=433 height=399 alt loading=lazy><p>Intuitively, this made sense to me. The arguments in the formula above were <em>keys</em> and not <em>values</em>. So likely, this is using those sets of keys to find stats from this stats object, keyed by some sort of stat id value. Unfortunately, it doesn&rsquo;t seem like the stat <em>names</em> are available elsewhere in the payload, just more values to corroborate what&rsquo;s in the payload with what&rsquo;s display in the UI.</p><p>Looking back into the UI, the stat ID value is displayed on all of the stats visible in the table. This should help me map arguments to these pretty well.</p><img src=https://zmsy.co/blog/reverse-engineering-espn/h-devtools-stat-id-value.png width=423 height=278 alt loading=lazy><p>Searching through these, it&rsquo;s fairly intuitive to map some of them back to the 2002 formula using their position in the formula, and others it&rsquo;s possible to do by finding examples of that stat in use.</p><p><strong>De-anonymized ESPN RC arguments:</strong></p><ul><li><code>a</code> - <strong>Hits</strong>. Values line up in calculation, and stat ID value matches the UI display in React DevTools.</li><li><code>b</code> - <strong>Walks</strong>. Used positionally in multiple places in the same way as the 2002 calculation, and id value lined up with UI.</li><li><code>c</code> - <strong>Caught Stealing</strong> - <code>c</code>/<code>d</code> are interchangeable here. These seemed to align with data shown (hard at this point in the year due to small sample size), but they&rsquo;re only used once so it doesn&rsquo;t matter which is which. Swapping these two would net the same result.</li><li><code>d</code> - <strong>Ground into Double Play</strong> - See above.</li><li><code>e</code> - <strong>At Bats</strong> - Remembering that the denominator portion of the calculation quantifies Opportunities, this is the most basic representation of how many opportunities a player gets. Also, this ID value aligned with UI so that&rsquo;s nice.</li><li><code>f</code> - <strong>Sacrifice Flies</strong> - Based on what&rsquo;s being calculated, this is either Hit by Pitch, Sacrifice Hits, or Sacrifice Flies. It&rsquo;s used in multiple places, similar to the 2002 version. I found some examples of this aligning with the values shown on the player&rsquo;s full-year stats page on ESPN, so SF seems the most likely.</li><li><code>g</code> - <strong>Total Bases</strong> - This was only obvious after looking at several other pages, since TB is rarely displayed in the UI in ESPN.</li><li><code>h</code> - <strong>Stolen Bases</strong> - Our league doesn&rsquo;t use Stolen Bases as a metric (hint: <a href=https://batflipsandnerds.com/2018/11/03/analytics-and-its-effects-on-the-mlb-the-stolen-base/>because stolen bases aren&rsquo;t a good idea in baseball, and are generally useless as a statistic</a>), but this one was easy to corroborate across a few different players.</li><li><code>i</code> - <strong>Strikeouts</strong> - Based on how little of an impact Ks have on RC calculations writ large, this seemed like a safe assumption to make. The coefficient is an order of magnitude lower in the ESPN calculation, so this will be even a smaller impact.</li></ul><p>Mapping those back, here&rsquo;s the <strong>ESPN RC Formula with named arguments</strong>:</p><pre tabindex=0><code>A = Hits + Walks - Caught Stealing - Ground into Double Play
B = Total Bases + (Walks * 0.26) + (Sacrifice Flies * 0.53)
    + (Stolen Bases * 0.64) - (Strikeouts * 0.03)
C = At Bats + Walks + Sacrifice Flies
D = ((2.4 * C) + A) x ((3 * C) + B))
RC = (D ÷ (9 x C)) – (0.9 x C)
</code></pre><h2 id=correcting-the-calculation>Correcting the Calculation</h2><p>Let&rsquo;s look at another example of RC being negative and show these arguments in that calculation now. This is <code>-.6</code>.</p><img src=https://zmsy.co/blog/reverse-engineering-espn/phonec-whit-merrifield-negative-rc.png width=643 height=343 alt loading=lazy><p>This is the top currently available batter in our league, Whit Merrifield. He&rsquo;s owned in most leagues because he loves stealing bases. He&rsquo;s not owned in ours because we don&rsquo;t care. His 2022 stats, for the calculation:</p><table><thead><tr><th>G</th><th>AB</th><th>PA</th><th>H</th><th>1B</th><th>2B</th><th>3B</th><th>HR</th><th>R</th><th>TB</th></tr></thead><tbody><tr><td>17</td><td>71</td><td>75</td><td>9</td><td>7</td><td>2</td><td>0</td><td>0</td><td>3</td><td>11</td></tr></tbody></table><table><thead><tr><th>RBI</th><th>BB</th><th>IBB</th><th>SO</th><th>HBP</th><th>SF</th><th>SH</th><th>GDP</th><th>SB</th><th>CS</th></tr></thead><tbody><tr><td>4</td><td>3</td><td>0</td><td>11</td><td>0</td><td>1</td><td>0</td><td>3</td><td>3</td><td>0</td></tr></tbody></table><p>Let&rsquo;s plug these into the ESPN RC formula and see if we can identify why this output is negative.</p><pre tabindex=0><code>A = 9 + 3 - 0 - 3 = 9
B = 11 + (3 * 0.26) + (1 * 0.53) + (3 * 0.64) - (11 * 0.03) = 13.9
C = 71 + 3 + 1 = 75
D = ((2.4 * C) + A) x ((3 * C) + B)) = 45,152.1
RC = (D ÷ (9 x C)) – (0.9 x C)
</code></pre><p>Output: <strong>-0.61 Runs Created</strong></p><p>In this scenario, the numerator is just simply not high enough. The denominator is <em>seemingly more correct</em> in this case, because the missing statistics shouldn&rsquo;t actually affect it that much. The offensive value in the A and B portions of the calculation is too low.</p><p>What does the 2002 calculation say Whit&rsquo;s actual Runs Created should be?</p><pre tabindex=0><code>Let A = 9 + 3 – 0 + 0 – 3
Let B = (1.125 x 7) + (1.69 x 2) + (3.02 x 0) + (3.73 x 0)
        + (0.29 x (3 – 0 + 0))
        + (0.492 x (0 + 1 + 3))
        – (0.4 x 11)
Let C = 71 + 3 + 0 + 0 + 1
Let D = ((2.4 x C) + A) x ((3 x C) + B))
RC = (D ÷ (9 x C)) – (0.9 x C)
</code></pre><p>Output: <strong>-0.67 Runs Created</strong></p><figure class=color-responsive-svg style=height:5rem><svg viewBox="0 0 331 106" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M3.19 5.06c4.88.0 26.97-1.05 32.46.0 1.73.33 1.57 11.32.68 12.9-1.53 2.7-13.32 1.17-9.72 3.42 7.2 4.5 12.78 31.57 14.25 31.73 1.26.13 16.96-31.34 16.56-32.25-.85-1.92-7.8-3.37-8.51-6.25-.29-1.17 1.91-10.36 1.91-10.36s24.9-.57 30.5 1.05c.39.11 1.3 9.41.59 10.75-.12.23-10.55 6.96-11.14 9.62-2.37 10.69-23.1 37.54-19.95 48.01.94 3.1-.27 9.72.0 10.63.52 1.75 8.64 3.73 8.64 7.1.0.34.3 8.64.0 8.71-5.16 1.28-32.85 1.29-32.85 1.29s-2.84-12.67-2.84-15.52c0-.37 5.52-.35 7.44-1.58.63-.4-.14-6.8-.17-7.2-.33-4.96-.55-9.86-.55-14.83.0-.56-20.98-44.82-21.97-44.45-1.2.45-4.65 1.16-5.33.0-2.49-4.2.0-12.77.0-12.77zm76.96 26.17c5.88.0 22.95-1.67 23.45-.3.37 1.01 2.7 52.03 3.27 52.53 1.37 1.2 8.02 1.85 9.13 1.7 4.17-.6 8.48-1.93 11.9-4.42.61-.44 4.84-25.2 4.9-33.16.0-.17-12.49-2.66-11.83-6.4.73-4.14 1.45-10.69 1.47-10.69.95.0 27.2-1.08 27.53-.74.06.06-2.6 48.3-3.66 53.76-.14.7 5.61-.14 6.32.0 1.53.3 3.06 1.66 3.06 3.18.0 2.27.74 10.38.57 10.42-4.67 1.1-9.31 2.65-14.02 3.81-1.36.34-4.12 1.18-5.51.63-1.44-.57-3.86-6.87-3.93-6.87-1.58.06-31.37 16.13-41.07 2.43-6.67-9.43-3.53-41.9-3.97-45.18-.55-4.12-.76-4.87-4.28-7.3-1.21-.84-4.46-1.92-4.97-3.45-.3-.91 1.64-9.95 1.64-9.95zm137.03 4.03c-9.89-4.16-17.4-4.04-19.81-4.05-27.3-.12-31.25 20.23-31.97 22.6-4.47 14.58-1.41 34.74 9.07 43.11 14.66 11.73 38.58 1.66 42.71-2.67.3-.3-4.66-10.92-4.77-10.97-.16-.08-19.8 5.21-25.01.0-4.68-4.67-4.7-18.51-4.65-21.25.3-15.25 11.16-17.43 15.4-17.14 2.21.16 1.28 7.26 1.46 7.48.28.35 9.1-.17 11.8-.17 1.67.0 5.77-16.94 5.77-16.94zm37.79 20.69c0-1.23 9.68-11.15 9.64-11.3-.03-.17-2.38-2.23-2.72-3.26-.22-.69.6-13.22.96-13.34.93-.3 26.25 3.1 34.41 4.64.27.05-.43 7.63-1.03 9.5-.12.37-13.31 5.48-14.68 5.88-.43.13-12.98 15.6-12.93 15.98.02.14 12.68 13.92 16.28 16.33.78.52 11.75 2 11.86 2.21.2.38-.95 16-1.71 17.75-.12.27-23.39-.95-23.65-.97-.73-.06-4.35-13.2-5.31-15.3-.2-.4-8-12.3-12.38-17.91.0.0-5.16-.3-5.15 1.85.05 9.7.03 17-.13 17.95-.36 2.1 6.01 3.8 6.67 4.9.67 1.13.46 6.27.01 7.41-.24.63-22.4 4.53-28.63 3.98-.57-.05-2.16-8.84-2.2-10.3.0-.94 3.66-2.83 4.29-3.27 2.1-1.49 1.77-2.17 1.77-4.81.0-17.03 1.83-66.47 1.68-66.53-.58-.25-7.45.3-7.51.0-.6-2.82-.47-13.17-.47-13.17 9.05.0 18.26-3.3 27.44-1.6 1.11.2-2.89 8-3.05 8.5-.33 1.06.0 24.59.13 46.02l6.41-1.14zm53.16 40.35c-.27-7.02.02-19.4 13.52-15 1.39.46 13.61 9.78 1.8 20.67-1.89 1.74-14.94 4.27-15.32-5.67z" fill="none" stroke="#38332a" stroke-width="4.17"/></svg></figure><p>Welp, that&rsquo;s unfortunate. Turns out my assumption that RC would never be negative with any of the official calculations was also wrong. Feels&mldr;not right.</p><p>Other calculation results:</p><ul><li>Basic Method: <strong>1.78</strong></li><li>Stolen Bases Method: <strong>1.76</strong></li><li>Technical Method: <strong>1.66</strong></li></ul><p>All of these intuitively seem more correct to me.</p><p>So turns out, ESPN&rsquo;s approach isn&rsquo;t necessarily <em>wrong</em> here, as it&rsquo;s just a modified version of a calculation for which I don&rsquo;t like the result. The name &ldquo;Runs Created&rdquo; to me implies that you can only <em>add</em> runs to your teams total, and you should never be able to CREATE negative runs.</p><h2 id=but-somethings-broken-here-right>But&mldr; Something&rsquo;s Broken Here, Right?</h2><p>Just accepting that the calculation works differently than I assumed for years and that the weirdness in the UI didn&rsquo;t sit well with me, so I dug a little more. The actual issue is two-part here:</p><ol><li>I didn&rsquo;t understand that some RC calculations can be negative and,</li><li>Some of the calculations are bugged and just wrong. The results for those is <code>.0</code> every time.</li></ol><p>Almost all of the players on my team&rsquo;s 7-day RC calculations are zero:</p><img src=https://zmsy.co/blog/reverse-engineering-espn/j-incorrect-rc-values.png width=411 height=447 alt loading=lazy><p>Plugging the top row&rsquo;s values into the ESPN RC formula, the RC column should read <strong>2.68 Runs Created</strong>.</p><p>I don&rsquo;t have any answers here, but this is an actually invalid output. I&rsquo;m guessing this is a null safety issue, because when you check the <code>rawStats</code> object, at least one of the argument values is missing every time this returns <code>.0</code>. I thought to try to pinpoint this, but the minified code makes that a chore.</p><p>Welp, that&rsquo;s that. Unsatisfying conclusion. I&rsquo;ll leave the poor folks on the ESPN support line alone and just use the other calculation where I can.</p></div></div></section></div></div></div><footer class=footer><div class="container has-text-centered"><figure class="color-responsive-svg footer-dots"><svg viewBox="0 0 262 6" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M128.2 1.1c-1.3 1.6-.5 2.6-.3 2m131.6.5c.8-.5-.6.7-1 .4-.3-.1.7-.4.5-.4M2.1 1.7c1 0 .4.2.3.4m59 .9c-.5.2 1.5-.7 1-.3m131.7-.6c0 .8-1.8 1.5-1.3 2.1.5.6 1.2-1.8 1.2-.5.0.8-2.2 1.3-2.2.5" fill="none" stroke="#faf9f9" stroke-width="2"/><path d="M61.7 1.4c-.7.8.6.3.7.5.2.4-.6 1.6-.8 1.2.0-.2.5.0.3.0m67-1.1c-.3-.8-1 1.2-1.2.3.0-.6 1.2-.5 1.3-.1.0.0-1.1.5-1.1.8M2.7 2.3c-.4.1.3 1 0 1.1-.3.2.0-1.2.3-1.2.4.0-.2.8-.4.3.0-.3.0-.8.5-.9v.5c0-.3.3-.8-.1-1-.2-.2-.3.4-.5.6-.2.0-.5-.2-.4-.4.0.0.8.3.5.7-.3.3-.5-.3-.5-.3-.2.0.0.5-.1.6-.2.2-1.2.4-.8.9.3.3.9-.9.9-.9L1.8 2s-1 .7-.7.7c.2.0.3-.6.4-.7m258.9 1.5c.5-.3-.2.3-.5.2-.2-.2-.2-.7.1-.7.5.0.0 1.4-.3 1.3-.2-.1-.2-1.2.1-1.2s.3.8.0.8c-.4.0-.5-1.1-.2-1 .2.0-.4 1-.5.9l.1-.5v.8" fill="none" stroke="#faf9f9" stroke-width="2"/></svg></figure><div id=footer-icons><a href=https://www.linkedin.com/in/zmsy><span class=icon-linkedin-square title="View my LinkedIn profile."></span></a>
<a href=https://github.com/zmsy><span class=icon-github title="Check out my Github."></span></a>
<a href=https://twitter.com/_zmsy><span class=icon-twitter title="Check out my sparsely used Twitter account."></span></a></div><p id=footer-text><strong>zmsy.co</strong> - by Zach Morrissey</p><p>Copyright © 2022</p></div></footer><script type=text/javascript src=https://zmsy.co/ts/index.63972e0cff68f6c041ebc75d974b38c6030a8518cf8a3883f485ec7216f414cb.js integrity="sha256-Y5cuDP9o9sBB68ddl0s4xgMKhRjPijiD9IXschb0FMs=" defer></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-104524581-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>