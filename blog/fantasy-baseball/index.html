<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us class=is-clipped><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=https://zmsy.co/><title>zmsy | Automated Fantasy Baseball Research Using Python, Pandas, and Seaborn</title><meta name=og:title content="Automated Fantasy Baseball Research Using Python, Pandas, and Seaborn"><meta name=description content="There's a lot of cool stuff you can do with available baseball data for fantasy uses. Here are some examples of what I did for the 2018 season."><meta name=og:description content="There's a lot of cool stuff you can do with available baseball data for fantasy uses. Here are some examples of what I did for the 2018 season."><meta name=theme-color content="#3a89c9"><link rel=preload href=https://zmsy.co/fonts/patua-one/patua-one-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://zmsy.co/fonts/work-sans/work-sans-latin-400-normal.woff2 as=font type=font/woff2 crossorigin><style>@font-face{font-family:patua one;font-weight:400;font-display:block;src:url(/fonts/patua-one/patua-one-latin-400-normal.woff2)format("woff2"),url(/fonts/patua-one/patua-one-latin-400-normal.woff)format("woff")}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-400-normal.woff2)format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-ext-400-normal.woff2)format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:work sans;font-style:italic;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-400-italic.woff2)format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:italic;font-display:swap;font-weight:400;src:url(/fonts/work-sans/work-sans-latin-ext-400-italic.woff2)format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:700;src:url(/fonts/work-sans/work-sans-latin-700-normal.woff2)format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:work sans;font-style:normal;font-display:swap;font-weight:700;src:url(/fonts/work-sans/work-sans-latin-ext-700-normal.woff2)format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:icomoon;src:url(/fonts/icomoon/icomoon.eot);src:url(/fonts/icomoon/icomoon.eot)format("embedded-opentype"),url(/fonts/icomoon/icomoon.ttf)format("truetype"),url(/fonts/icomoon/icomoon.woff)format("woff"),url(/fonts/icomoon/icomoon.svg)format("svg");font-weight:400;font-style:normal;font-display:block}[class^=icon-],[class*=" icon-"]{font-family:icomoon!important;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-heart:before{content:"\f004"}.icon-star:before{content:"\f005"}.icon-check:before{content:"\f00c"}.icon-close:before{content:"\f00d"}.icon-remove:before{content:"\f00d"}.icon-times:before{content:"\f00d"}.icon-external-link:before{content:"\f08e"}.icon-cut:before{content:"\f0c4"}.icon-scissors:before{content:"\f0c4"}.icon-copy:before{content:"\f0c5"}.icon-files-o:before{content:"\f0c5"}.icon-caret-down:before{content:"\f0d7"}.icon-caret-up:before{content:"\f0d8"}.icon-caret-left:before{content:"\f0d9"}.icon-caret-right:before{content:"\f0da"}.icon-cloud-download:before{content:"\f0ed"}.icon-chevron-circle-up:before{content:"\f139"}.icon-chevron-circle-down:before{content:"\f13a"}.icon-sliders:before{content:"\f1de"}.icon-spotify:before{content:"\e900"}.icon-envelope:before{content:"\e901"}.icon-github:before{content:"\e902"}.icon-twitter:before{content:"\e903"}.icon-linkedin-square:before{content:"\e904"}.icon-paw:before{content:"\e905"}</style><link rel=stylesheet href=https://zmsy.co/css/main.b2d6948d9c8d9831e65b519f832182b8448be54e38140c7f847543512055e7d0.css integrity="sha256-staUjZyNmDHmW1GfgyGCuESL5U44FAx/hHVDUSBV59A="><link rel=icon type=image/png href=https://zmsy.co/media/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://zmsy.co/media/favicon-16x16.png sizes=16x16><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/zmsy.co\/"},"name":"Automated Fantasy Baseball Research Using Python, Pandas, and Seaborn","headline":"Automated Fantasy Baseball Research Using Python, Pandas, and Seaborn","description":"There\u0027s a lot of cool stuff you can do with available baseball data for fantasy uses. Here are some examples of what I did for the 2018 season.","inLanguage":"en-US","author":"Zach Morrissey","creator":"Zach Morrissey","publisher":"Zach Morrissey","copyrightHolder":"Zach Morrissey","copyrightYear":"2022","datePublished":"2018-01-31","dateModified":"2022-06-07T01:56:42Z","url":"https:\/\/zmsy.co\/blog\/fantasy-baseball\/","keywords":["Blog"]}</script></head><body><div id=nav-modal></div><div class="columns is-centered" id=navbar-columns><div class="column is-10 is-12-touch" id=navbar-column><nav class=navbar role=navigation id=top><div class=navbar-brand><a class=navbar-item href=https://zmsy.co/><figure class="color-responsive-svg logo-img"><!doctype html><svg width="100%" height="100%" viewBox="0 0 209 209" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5"><circle cx="170.833" cy="33.333" r="33.333" style="fill:#9665c7"/><circle cx="127.778" cy="175" r="33.333" style="fill:#3a89c9"/><circle cx="37.5" cy="175" r="33.333" style="fill:#d85d44"/><circle cx="80.556" cy="33.333" r="33.333" style="fill:#fbd136"/><path d="M37.5 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M127.778 175V66.667" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M170.833 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/><path d="M80.556 137.514V33.333" style="fill:none;stroke:#38332a;stroke-width:14.58px"/></svg></figure></a><a class=navbar-item href=https://zmsy.co/><div class=is-3 id=logo-text>zmsy.co</div></a><span class=navbar-burger id=navbar-toggle><span></span><span></span><span></span></span></div><div class=navbar-menu><div class=navbar-end><a class="navbar-item is-hidden-mobile" href=https://www.linkedin.com/in/zmsy><span class=icon-linkedin-square title="View my LinkedIn profile."></span></a><a class="navbar-item is-hidden-mobile" href=https://github.com/zmsy><span class=icon-github title="Check out my Github."></span></a><a class="navbar-item is-hidden-mobile" href=https://twitter.com/_zmsy><span class=icon-twitter title="Check out my sparsely used Twitter account."></span></a><a class="navbar-item is-tab" href=https://zmsy.co/>Home</a>
<a class="navbar-item is-tab" href=https://zmsy.co/blog>Blog</a>
<a class="navbar-item is-tab" href=https://zmsy.co/recipes>Recipes</a>
<a class="navbar-item is-tab" href=https://zmsy.co/about>About</a></div></div></nav></div></div><div id=body><div class="columns is-centered is-desktop"><div class="column is-8 is-12-touch"><section class=section><div class=blog-post><h2><a class="title title-dark blog-title is-size-1-touch" href=https://zmsy.co/blog/fantasy-baseball/>Automated Fantasy Baseball Research Using Python, Pandas, and Seaborn</a></h2><p class=meta>written by
<a href=https://twitter.com/_zmsy>Zach Morrissey</a>
on 2018-03-15</p><figure class="color-responsive-svg hero-diamonds"><svg viewBox="0 0 834 125" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M367.37 61.19c-.76-2.1 45.86-44.42 46.4-44.08 2.37 1.48 51.98 43.68 52.07 44.08.21.94-46.95 44.13-48.74 43.85-2.41-.38-46.06-33.82-49.73-43.85zm362.5-2.59c-.12-.36 7.05-7.45 7.13-7.4.36.25 8 7.33 8 7.4.04.15-7.21 7.4-7.49 7.35-.37-.07-7.08-5.67-7.64-7.36zm69.49 1.75h1.02m-714.33-.08c-.1-.45 9.2-8.62 9.3-8.54.4.35 8.6 10.1 8.61 10.2.02.2-9.4 8.54-9.72 8.45-.43-.12-7.72-7.92-8.19-10.1zM25.7 62.26c-.38.2-1.2-.18-1.5.07-.35.27.19.73.58.34m299.45-19.82c-12.64 14.99-17.77 14.18-41.88 17.27-39.4 5.04-102.12 2.12-118.05 2.12m115.49-2.12c8.14.0 40.93.06 44.44 24.57M501.6 42.85c5.26 14.24 22.43 15.14 35.25 16.16 31.4 2.5 142.29 1.34 138.66 1.34M536.85 59c-6.7.9-31.2 14.06-35.24 26.24" fill="none" stroke="#38332a" stroke-width="20.83"/></svg></figure><div class=content><h2 id=winning-fantasy-baseball-in-style>Winning Fantasy Baseball in Style</h2><p>The advantages of doing my pre-season due diligence by scouting out the best fantasy baseball players often evaporates about 3 rounds into the draft. Since I can&rsquo;t win in the draft, why not automate my in-season scouting efforts?</p><h2 id=getting-data>Getting Data</h2><p>For a good system, there are three inputs:</p><ol><li>Roster data to know who is available.</li><li>Projections to see who is slated to do well.</li><li>Mid-season player statistics to so who&rsquo;s currently doing well.</li></ol><h3 id=1----roster-data>1 &ndash; Roster Data</h3><p>Our team uses ESPN for our league, which happens to allow access to webpages so long as you take the time to <a href="http://games.espn.com/flb/resources/help/content?name=create-league-standard">make the league public</a>. Getting roster data is fairly straightforward; all you need to do is scrape the rosters page for that league ID. This is an example of that:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>requests</span>
<span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>csv</span>
<span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>bs4</span> <span style=color:#069;font-weight:700>import</span> BeautifulSoup

<span style=color:#09f;font-style:italic># rip your league id from your espn url</span>
league_id <span style=color:#555>=</span> <span style=color:#f60>1234567890</span>
LEAGUE_URL <span style=color:#555>=</span> <span style=color:#c30>&#34;http://games.espn.com/flb/leaguerosters?leagueId={}&#34;</span>
html <span style=color:#555>=</span> requests<span style=color:#555>.</span>get(LEAGUE_URL<span style=color:#555>.</span>format(league_id))<span style=color:#555>.</span>text

<span style=color:#09f;font-style:italic># parse the page to return the rosters table</span>
soup <span style=color:#555>=</span> BeautifulSoup(html)
rosters <span style=color:#555>=</span> soup<span style=color:#555>.</span>find_all(<span style=color:#c30>&#34;table&#34;</span>, {<span style=color:#c30>&#39;class&#39;</span>: <span style=color:#c30>&#39;playerTableTable&#39;</span>})

<span style=color:#09f;font-style:italic># loop through the rosters table and get all of the associated values</span>
players <span style=color:#555>=</span> []
<span style=color:#069;font-weight:700>for</span> roster <span style=color:#000;font-weight:700>in</span> rosters:
    team_name <span style=color:#555>=</span> roster<span style=color:#555>.</span>find(<span style=color:#c30>&#34;a&#34;</span>)<span style=color:#555>.</span>text
    players_html <span style=color:#555>=</span> roster<span style=color:#555>.</span>find_all(<span style=color:#c30>&#34;td&#34;</span>, {<span style=color:#c30>&#39;class&#39;</span>: <span style=color:#c30>&#39;playertablePlayerName&#39;</span>})
    <span style=color:#069;font-weight:700>for</span> player <span style=color:#000;font-weight:700>in</span> players_html:

        <span style=color:#09f;font-style:italic># parse player info, remove asterisks for injured players.</span>
        player_name <span style=color:#555>=</span> player<span style=color:#555>.</span>text<span style=color:#555>.</span>split(<span style=color:#c30>&#34;,&#34;</span>)[<span style=color:#f60>0</span>]
        player_name <span style=color:#555>=</span> player_name<span style=color:#555>.</span>replace(<span style=color:#c30>&#34;*&#34;</span>, <span style=color:#c30>&#34;&#34;</span>)

        <span style=color:#09f;font-style:italic># add to output list</span>
        players<span style=color:#555>.</span>append([player_name, team_name])

<span style=color:#09f;font-style:italic># write out to a csv</span>
<span style=color:#069;font-weight:700>with</span> <span style=color:#366>open</span>(<span style=color:#c30>&#34;rosters.csv&#34;</span>, <span style=color:#c30>&#34;w&#34;</span>, newline<span style=color:#555>=</span><span style=color:#c30>&#39;&#39;</span>) <span style=color:#069;font-weight:700>as</span> out_file:
    writer <span style=color:#555>=</span> csv<span style=color:#555>.</span>writer(out_file)
    writer<span style=color:#555>.</span>writerow((<span style=color:#c30>&#34;player&#34;</span>, <span style=color:#c30>&#34;team&#34;</span>))
    writer<span style=color:#555>.</span>writerows(players)
</code></pre></div><h3 id=2----projections>2 &ndash; Projections</h3><p>Player projections are common source of scouting information for our league. Since we do not use the standard scoring rules, the projections from ESPN are mostly worthless to us (not that they&rsquo;re particularly valuable otherwise). For my own purposes, I like the <a href="https://www.fangraphs.com/projections.aspx?pos=all&stats=bat&type=fangraphsdc">Depth Charts projection system</a> that they use, which is a combination of two other common projection systems (ZiPS and Steamer) weighted by an in-house projection for playing time.</p><h4 id=getting-data-with-curl>Getting Data with cURL</h4><p>There were two issues I was trying to solve for.</p><ol><li><strong>Not enough players</strong> - URL parameters & form fields didn&rsquo;t seem to contain an ability to get more than 50 players at once.</li><li><strong>Confusing ASP.net forms</strong> - These use built-in Microsoft libraries that send back somewhere between 50-60kb of base64-encoded page state data, which is a lot of added noise for my purposes.</li></ol><p>Using the network tab, I found that the link for &lsquo;page size&rsquo; allowed me to request higher amounts of players than the values in the form dropdown.</p><img src=https://zmsy.co/blog/fantasy-baseball/page_size.png width=556 height=197 alt="Fangraphs Page Size Dropdown" loading=lazy><ol><li>Navigate to the chrome developer tools network tab.</li><li>Filter to <code>method:POST</code> so you only get the form post and none of the other resource requests.</li><li>Right click on the post and select <code>copy</code> > <code>copy as cURL (bash)</code>.</li></ol><img src=https://zmsy.co/blog/fantasy-baseball/copy_as_curl.png width=564 height=481 alt="Chrome Network Tab for Fangraphs Page" loading=lazy><p>I ripped that data out into two files, <code>get_fangraphs.sh</code> (send the request), and <code>fangraphs_form_data.txt</code>. Since the data is over a certain volume with curl, you need to store it in its own file and load it using the <code>-d</code> flag.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#09f;font-style:italic># get batters projections html</span>
curl <span style=color:#c30>&#39;https://www.fangraphs.com/projections.aspx?pos=all&amp;stats=bat&amp;type=rfangraphsdc&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Accept-Encoding: gzip, deflate, br&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Accept-Language: en-US,en;q=0.9&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Upgrade-Insecure-Requests: 1&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -d @batters_form_data.txt --compressed <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    &gt; batters_projections.html

<span style=color:#09f;font-style:italic># get pitching projections</span>
curl <span style=color:#c30>&#39;https://www.fangraphs.com/projections.aspx?pos=all&amp;stats=pit&amp;type=rfangraphsdc&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Accept-Encoding: gzip, deflate, br&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Accept-Language: en-US,en;q=0.9&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Upgrade-Insecure-Requests: 1&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -H <span style=color:#c30>&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#39;</span> <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    -d @pitchers_form_data.txt --compressed <span style=color:#c30;font-weight:700>\
</span><span style=color:#c30;font-weight:700></span>    &gt; pitchers_projections.html
</code></pre></div><p>In the <code>(batters|pitchers)_form_data.txt</code> file, there was one adjustment to make to get a higher number than 50 entries back: <code>__EVENTARGUMENT=FireCommand:ProjectionBoard1$dg1$ctl00;PageSize;50</code> - change this <code>50</code> to something like <code>2500</code> or so.</p><p>Voila! You&rsquo;ve now got a page with the HTML table containing all of the projections information there is to want. You can then plug use pandas' <code>read_html()</code> function to parse this output for you.</p><h3 id=3----actuals>3 &ndash; Actuals</h3><p>In addition to projections, having in-season results helps improve our judgment and add context to the projections. There are players whom are specifically favored by the projection systems (namely, players with long histories), and players who are treated rather unkindly (small sample sizes).</p><p>Getting the ongoing statistics on a per-player basis turned out to be much easier than anything related to the projections. With a little manipulation of URL parameters, you can easily create a page for scraping that contains all of the necessary information in one go.</p><ul><li><a href="https://www.fangraphs.com/leaders.aspx?pos=all&stats=pit&lg=al&qual=y&type=c,36,37,38,40,-1,120,121,217,-1,24,41,42,43,44,-1,117,118,119,-1,6,45,124,-1,62,122,13&season=2018&month=0&season1=2018&ind=0&team=0&rost=0&age=0&filter=&players=0&page=1_100000">Pitching Stats</a></li><li><a href="https://www.fangraphs.com/leaders.aspx?pos=all&stats=bat&lg=al&qual=y&type=8&season=2018&month=0&season1=2018&ind=0&team=0&rost=0&age=0&filter=&players=0&page=1_10000">Batting Stats</a></li></ul><p>Creating a short script to parse out player rows and add them to another csv for consumption later on turned out to be short work once I figured this bit out. Here&rsquo;s the script I used (uses requests and beautifulsoup, similar to above):</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>requests</span>
<span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>csv</span>
<span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>datetime</span>
<span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>bs4</span> <span style=color:#069;font-weight:700>import</span> BeautifulSoup

<span style=color:#09f;font-style:italic># static urls</span>
season <span style=color:#555>=</span> datetime<span style=color:#555>.</span>datetime<span style=color:#555>.</span>now()<span style=color:#555>.</span>year
PITCHERS_URL <span style=color:#555>=</span> <span style=color:#c30>&#34;https://www.fangraphs.com/leaders.aspx?pos=all&amp;stats=pit&amp;lg=all&amp;qual=0&amp;type=c,36,37,38,40,-1,120,121,217,-1,24,41,42,43,44,-1,117,118,119,-1,6,45,124,-1,62,122,13&amp;season={season}&amp;month=0&amp;season1={season}&amp;ind=0&amp;team=0&amp;rost=0&amp;age=0&amp;filter=&amp;players=0&amp;page=1_100000&#34;</span><span style=color:#555>.</span>format(season<span style=color:#555>=</span>season)
BATTERS_URL <span style=color:#555>=</span> <span style=color:#c30>&#34;https://www.fangraphs.com/leaders.aspx?pos=all&amp;stats=bat&amp;lg=all&amp;qual=0&amp;type=8&amp;season={season}&amp;month=0&amp;season1={season}&amp;ind=0&amp;team=0&amp;rost=0&amp;age=0&amp;filter=&amp;players=0&amp;page=1_10000&#34;</span><span style=color:#555>.</span>format(season<span style=color:#555>=</span>season)

<span style=color:#09f;font-style:italic># request the data</span>
pitchers_html <span style=color:#555>=</span> requests<span style=color:#555>.</span>get(PITCHERS_URL)<span style=color:#555>.</span>text
batters_html <span style=color:#555>=</span> requests<span style=color:#555>.</span>get(BATTERS_URL)<span style=color:#555>.</span>text

<span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>parse_array_from_fangraphs_html</span>(input_html, out_file_name):
    <span style=color:#c30>&#34;&#34;&#34;
</span><span style=color:#c30>    Take a HTML stats page from fangraphs and parse it out to a CSV file.
</span><span style=color:#c30>    &#34;&#34;&#34;</span>
    <span style=color:#09f;font-style:italic># parse input</span>
    soup <span style=color:#555>=</span> BeautifulSoup(input_html, <span style=color:#c30>&#34;lxml&#34;</span>)
    table <span style=color:#555>=</span> soup<span style=color:#555>.</span>find(<span style=color:#c30>&#34;table&#34;</span>, {<span style=color:#c30>&#34;class&#34;</span>: <span style=color:#c30>&#34;rgMasterTable&#34;</span>})
    
    <span style=color:#09f;font-style:italic># get headers</span>
    headers_html <span style=color:#555>=</span> table<span style=color:#555>.</span>find(<span style=color:#c30>&#34;thead&#34;</span>)<span style=color:#555>.</span>find_all(<span style=color:#c30>&#34;th&#34;</span>)
    headers <span style=color:#555>=</span> []
    <span style=color:#069;font-weight:700>for</span> header <span style=color:#000;font-weight:700>in</span> headers_html:
        headers<span style=color:#555>.</span>append(header<span style=color:#555>.</span>text)
    <span style=color:#069;font-weight:700>print</span>(headers)
    
    <span style=color:#09f;font-style:italic># get rows</span>
    rows <span style=color:#555>=</span> []
    rows_html <span style=color:#555>=</span> table<span style=color:#555>.</span>find(<span style=color:#c30>&#34;tbody&#34;</span>)<span style=color:#555>.</span>find_all(<span style=color:#c30>&#34;tr&#34;</span>)
    <span style=color:#069;font-weight:700>for</span> row <span style=color:#000;font-weight:700>in</span> rows_html:
        row_data <span style=color:#555>=</span> []
        <span style=color:#069;font-weight:700>for</span> cell <span style=color:#000;font-weight:700>in</span> row<span style=color:#555>.</span>find_all(<span style=color:#c30>&#34;td&#34;</span>):
            row_data<span style=color:#555>.</span>append(cell<span style=color:#555>.</span>text)
        rows<span style=color:#555>.</span>append(row_data)
    
    <span style=color:#09f;font-style:italic># write to CSV file</span>
    <span style=color:#069;font-weight:700>with</span> <span style=color:#366>open</span>(out_file_name, <span style=color:#c30>&#34;w&#34;</span>) <span style=color:#069;font-weight:700>as</span> out_file:
        writer <span style=color:#555>=</span> csv<span style=color:#555>.</span>writer(out_file)
        writer<span style=color:#555>.</span>writerow(headers)
        writer<span style=color:#555>.</span>writerows(rows)
        
parse_array_from_fangraphs_html(batters_html, <span style=color:#c30>&#39;batters_actuals.csv&#39;</span>)
parse_array_from_fangraphs_html(pitchers_html, <span style=color:#c30>&#39;pitchers_actuals.csv&#39;</span>)
</code></pre></div><p>Normally, I would use pandas <a href=https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_html.html>read_html</a> function for parsing HTML tables like this (which uses lxml internally, same as BeautifulSoup), but the encoding of this table caused enough havoc that I decided to write the parser myself. If you&rsquo;re in a similar scenario, try that method first!</p><h2 id=reading-the-data-into-pandas>Reading the Data Into Pandas</h2><p><a href=https://pandas.pydata.org/>Pandas</a> is very capable of producing these sorts of analyses using tabular data in a straightforward, repeatable manner. Our league uses a customized stat list to base our categories on, so we have to derive many of these after getting actuals/projections.</p><h4 id=batting-stats>Batting Stats</h4><ul><li><strong>HR</strong>: Home Runs</li><li><strong>K</strong>: Strikeouts</li><li><strong>RC</strong>: Runs Created (AB * OBP * SLG)</li><li><strong>OBP</strong>: On Base Percentage</li><li><strong>SLG</strong>: Slugging Percentage</li></ul><h4 id=pitching-stats>Pitching Stats</h4><ul><li><strong>HR</strong>: Home Runs Against</li><li><strong>K</strong>: Strikeouts</li><li><strong>ERA</strong>: Earned Run Average</li><li><strong>QS</strong>: Quality Starts</li><li><strong>OBA</strong>: On-Base Percentage Against</li></ul><p>! There are plenty of different scoring methods used in fantasy. If you want to try this on yours, you can edit the code to use your own categories instead.</p><h4 id=pandas>Pandas</h4><p>Bringing this all into pandas is relatively easy, because of its <em>insanely</em> useful <code>read_csv()</code> function. Not only does this do your opening/reading for you, it almost always gets the data types correct as well.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#09f;font-style:italic># read in all outputs</span>
df_rost <span style=color:#555>=</span> pd<span style=color:#555>.</span>read_csv(<span style=color:#c30>&#39;rosters.csv&#39;</span>)
dfb_act <span style=color:#555>=</span> pd<span style=color:#555>.</span>read_csv(<span style=color:#c30>&#39;batters_actuals.csv&#39;</span>)
dfp_act <span style=color:#555>=</span> pd<span style=color:#555>.</span>read_csv(<span style=color:#c30>&#39;pitchers_actuals.csv&#39;</span>)

<span style=color:#09f;font-style:italic># create a function to parse out percentage strings to floats</span>
<span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>parse_pctg</span>(value):
    <span style=color:#069;font-weight:700>return</span> <span style=color:#366>float</span>(value<span style=color:#555>.</span>split()[<span style=color:#f60>0</span>]) <span style=color:#555>/</span> <span style=color:#f60>100</span>

<span style=color:#09f;font-style:italic># apply that to all percentage values in the dataframes</span>
dfb_act[<span style=color:#c30>&#39;BB%&#39;</span>] <span style=color:#555>=</span> dfb_act[<span style=color:#c30>&#39;BB%&#39;</span>]<span style=color:#555>.</span>apply(<span style=color:#069;font-weight:700>lambda</span> x: parse_pctg(x))
dfb_act[<span style=color:#c30>&#39;K%&#39;</span>] <span style=color:#555>=</span> dfb_act[<span style=color:#c30>&#39;K%&#39;</span>]<span style=color:#555>.</span>apply(<span style=color:#069;font-weight:700>lambda</span> x: parse_pctg(x))
dfp_act[<span style=color:#c30>&#39;K%&#39;</span>] <span style=color:#555>=</span> dfp_act[<span style=color:#c30>&#39;K%&#39;</span>]<span style=color:#555>.</span>apply(<span style=color:#069;font-weight:700>lambda</span> x: parse_pctg(x))
dfp_act[<span style=color:#c30>&#39;BB%&#39;</span>] <span style=color:#555>=</span> dfp_act[<span style=color:#c30>&#39;BB%&#39;</span>]<span style=color:#555>.</span>apply(<span style=color:#069;font-weight:700>lambda</span> x: parse_pctg(x))
dfp_act[<span style=color:#c30>&#39;K-BB%&#39;</span>] <span style=color:#555>=</span> dfp_act[<span style=color:#c30>&#39;K-BB%&#39;</span>]<span style=color:#555>.</span>apply(<span style=color:#069;font-weight:700>lambda</span> x: parse_pctg(x))
dfp_act[<span style=color:#c30>&#39;LOB%&#39;</span>] <span style=color:#555>=</span> dfp_act[<span style=color:#c30>&#39;LOB%&#39;</span>]<span style=color:#555>.</span>apply(<span style=color:#069;font-weight:700>lambda</span> x: parse_pctg(x))

<span style=color:#069;font-weight:700>with</span> <span style=color:#366>open</span>(<span style=color:#c30>&#39;batters_projections.html&#39;</span>, <span style=color:#c30>&#39;r&#39;</span>) <span style=color:#069;font-weight:700>as</span> bhtml:
    btxt <span style=color:#555>=</span> bhtml<span style=color:#555>.</span>read()
    dfb_proj <span style=color:#555>=</span> pd<span style=color:#555>.</span>read_html(btxt)[<span style=color:#555>-</span><span style=color:#f60>1</span>]  <span style=color:#09f;font-style:italic># read_html returns ALL tables, we just want the last one.</span>
    dfb_proj<span style=color:#555>.</span>dropna(axis<span style=color:#555>=</span><span style=color:#f60>1</span>, inplace<span style=color:#555>=</span>True)

<span style=color:#069;font-weight:700>with</span> <span style=color:#366>open</span>(<span style=color:#c30>&#39;pitchers_projections.html&#39;</span>, <span style=color:#c30>&#39;r&#39;</span>) <span style=color:#069;font-weight:700>as</span> phtml:
    ptxt <span style=color:#555>=</span> phtml<span style=color:#555>.</span>read()
    dfp_proj <span style=color:#555>=</span> pd<span style=color:#555>.</span>read_html(btxt)[<span style=color:#555>-</span><span style=color:#f60>1</span>]
    dfp_proj<span style=color:#555>.</span>dropna(axis<span style=color:#555>=</span><span style=color:#f60>1</span>, inplace<span style=color:#555>=</span>True)

<span style=color:#09f;font-style:italic># list of data sets: df_rost, dfb_act, dfb_proj, dfp_act, dfp_proj</span>
</code></pre></div><p>This means we&rsquo;ve got 5 inputs - one for rosters, two for projections, and two for actuals. Time to get crankin' on the analysis part!</p><h2 id=joining-and-visualizing-in-pandasseaborn>Joining and Visualizing in Pandas/Seaborn</h2><p>First we need to join the datasets together into two dataframes that will make things easier to use: batters and pitchers. Roster information goes into both.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#09f;font-style:italic># merge batters into one &#39;dfb&#39; Dataframe</span>
dfb <span style=color:#555>=</span> pd<span style=color:#555>.</span>merge(dfb_proj, df_rost, how<span style=color:#555>=</span><span style=color:#c30>&#39;left&#39;</span>, on<span style=color:#555>=</span><span style=color:#c30>&#39;Name&#39;</span>, suffixes<span style=color:#555>=</span>(<span style=color:#c30>&#39;.p&#39;</span>, <span style=color:#c30>&#39;.r&#39;</span>))
dfb <span style=color:#555>=</span> pd<span style=color:#555>.</span>merge(dfb, dfb_act, how<span style=color:#555>=</span><span style=color:#c30>&#39;left&#39;</span>, on<span style=color:#555>=</span><span style=color:#c30>&#39;Name&#39;</span>, suffixes<span style=color:#555>=</span>(<span style=color:#c30>&#39;&#39;</span>, <span style=color:#c30>&#39;.a&#39;</span>))

<span style=color:#09f;font-style:italic># merge pitchers into one &#39;dfp&#39; dataframe</span>
dfp <span style=color:#555>=</span> pd<span style=color:#555>.</span>merge(dfp_proj, df_rost, how<span style=color:#555>=</span><span style=color:#c30>&#39;left&#39;</span>, on<span style=color:#555>=</span><span style=color:#c30>&#39;Name&#39;</span>, suffixes<span style=color:#555>=</span>(<span style=color:#c30>&#39;.p&#39;</span>, <span style=color:#c30>&#39;.r&#39;</span>))
dfp <span style=color:#555>=</span> pd<span style=color:#555>.</span>merge(dfp, dfp_act, how<span style=color:#555>=</span><span style=color:#c30>&#39;left&#39;</span>, on<span style=color:#555>=</span><span style=color:#c30>&#39;Name&#39;</span>, suffixes<span style=color:#555>=</span>(<span style=color:#c30>&#39;&#39;</span>, <span style=color:#c30>&#39;.a&#39;</span>))
</code></pre></div><p><a href=https://www.fangraphs.com/plus/product/fangraphs-membership/>Also - If you use Fangraphs data a lot, it&rsquo;s worth considering becoming a member and supporting them a bit!</a></p></div></div></section></div></div></div><footer class=footer><div class="container has-text-centered"><figure class="color-responsive-svg footer-dots"><svg viewBox="0 0 262 6" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M128.2 1.1c-1.3 1.6-.5 2.6-.3 2m131.6.5c.8-.5-.6.7-1 .4-.3-.1.7-.4.5-.4M2.1 1.7c1 0 .4.2.3.4m59 .9c-.5.2 1.5-.7 1-.3m131.7-.6c0 .8-1.8 1.5-1.3 2.1.5.6 1.2-1.8 1.2-.5.0.8-2.2 1.3-2.2.5" fill="none" stroke="#faf9f9" stroke-width="2"/><path d="M61.7 1.4c-.7.8.6.3.7.5.2.4-.6 1.6-.8 1.2.0-.2.5.0.3.0m67-1.1c-.3-.8-1 1.2-1.2.3.0-.6 1.2-.5 1.3-.1.0.0-1.1.5-1.1.8M2.7 2.3c-.4.1.3 1 0 1.1-.3.2.0-1.2.3-1.2.4.0-.2.8-.4.3.0-.3.0-.8.5-.9v.5c0-.3.3-.8-.1-1-.2-.2-.3.4-.5.6-.2.0-.5-.2-.4-.4.0.0.8.3.5.7-.3.3-.5-.3-.5-.3-.2.0.0.5-.1.6-.2.2-1.2.4-.8.9.3.3.9-.9.9-.9L1.8 2s-1 .7-.7.7c.2.0.3-.6.4-.7m258.9 1.5c.5-.3-.2.3-.5.2-.2-.2-.2-.7.1-.7.5.0.0 1.4-.3 1.3-.2-.1-.2-1.2.1-1.2s.3.8.0.8c-.4.0-.5-1.1-.2-1 .2.0-.4 1-.5.9l.1-.5v.8" fill="none" stroke="#faf9f9" stroke-width="2"/></svg></figure><div id=footer-icons><a href=https://www.linkedin.com/in/zmsy><span class=icon-linkedin-square title="View my LinkedIn profile."></span></a><a href=https://github.com/zmsy><span class=icon-github title="Check out my Github."></span></a><a href=https://twitter.com/_zmsy><span class=icon-twitter title="Check out my sparsely used Twitter account."></span></a></div><p id=footer-text><strong>zmsy.co</strong> - by Zach Morrissey</p><p>Copyright © 2022</p></div></footer><script type=text/javascript src=https://zmsy.co/ts/index.3e1c5382252c5c65370c9bc6c94c9475133e65a4935ca5c749b48c7fa3674d4b.js integrity="sha256-PhxTgiUsXGU3DJvGyUyUdRM+ZaSTXKXHSbSMf6NnTUs=" defer></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-104524581-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>